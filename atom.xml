<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>子君的个人博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.zijunfe.cn/"/>
  <updated>2019-10-22T13:04:18.564Z</updated>
  <id>http://blog.zijunfe.cn/</id>
  
  <author>
    <name>Zi Jun</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>秀米集成到UEditor的配置过程</title>
    <link href="http://blog.zijunfe.cn/2019/10/22/xiumi/"/>
    <id>http://blog.zijunfe.cn/2019/10/22/xiumi/</id>
    <published>2019-10-22T01:57:39.000Z</published>
    <updated>2019-10-22T13:04:18.564Z</updated>
    
    <content type="html"><![CDATA[<h3 id="秀米集成到UEditor的配置过程"><a href="#秀米集成到UEditor的配置过程" class="headerlink" title="秀米集成到UEditor的配置过程"></a>秀米集成到UEditor的配置过程</h3><p>虽然秀米官方有提供文档说明如何将秀米插件集成至UEditor里(<a href="http://hgs.xiumi.us/uedit/" target="_blank" rel="noopener">秀米官方文档</a>)，但是该文档说明模糊不清，关键配置一句话带过，即使配置成功后还有坑留在里面。所以我重新整理了这个配置过程，回顾一下过程的同时也给以后需要用到的小伙伴提供便利。</p><a id="more"></a><h4 id="一、将秀米图标集成至工具栏，并且成功弹出秀米弹框"><a href="#一、将秀米图标集成至工具栏，并且成功弹出秀米弹框" class="headerlink" title="一、将秀米图标集成至工具栏，并且成功弹出秀米弹框"></a>一、将秀米图标集成至工具栏，并且成功弹出秀米弹框</h4><ol><li><p>首先我们需要一个秀米的html文件，这个html里主要就是弹框里的内容，里面有一个iframe指向秀米的网址。<br>取名xiumi-ue-dialog-v5.html,放入ueditor1_4_3_3文件夹(UE的资源文件夹)下或者ueditor1_4_3_3下的dialogs文件夹里，这个只是涉及到后面引入它的路径，不是很重要，我是放在ueditor1_4_3_3文件夹下的。</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ueditor1\_4\_3\_3/xiumi-ue-dialog-v5.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- saved from url=(0049)http://hgs.xiumi.us/uedit/xiumi-ue-dialog-v5.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>XIUMI connect<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  html, body &#123;</span></span><br><span class="line"><span class="undefined">    padding: 0;</span></span><br><span class="line"><span class="undefined">    margin: 0;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  #xiumi &#123;</span></span><br><span class="line"><span class="undefined">    position: absolute;</span></span><br><span class="line"><span class="undefined">    width: 100%;</span></span><br><span class="line"><span class="undefined">    height: 100%;</span></span><br><span class="line"><span class="undefined">    border: none;</span></span><br><span class="line"><span class="undefined">    box-sizing: border-box;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">"xiumi"</span> <span class="attr">src</span>=<span class="string">"//xiumi.us/studio/v5#/paper"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"./dialogs/internal.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    var xiumi = document.getElementById('xiumi');</span></span><br><span class="line"><span class="undefined">    var xiumi_url = window.location.protocol + "//xiumi.us";</span></span><br><span class="line"><span class="undefined">    xiumi.onload = function () &#123;</span></span><br><span class="line"><span class="undefined">        xiumi.contentWindow.postMessage('ready', xiumi_url);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">    document.addEventListener("mousewheel", function (event) &#123;</span></span><br><span class="line"><span class="undefined">        event.preventDefault();</span></span><br><span class="line"><span class="undefined">        event.stopPropagation();</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">    window.addEventListener('message', function (event) &#123;</span></span><br><span class="line"><span class="undefined">        if (event.origin == xiumi_url) &#123;</span></span><br><span class="line"><span class="undefined">            editor.execCommand('insertHtml', event.data);</span></span><br><span class="line"><span class="undefined">            // 这个方法用于触发UE的图片转存接口</span></span><br><span class="line"><span class="undefined">            editor.fireEvent('afterpaste');</span></span><br><span class="line"><span class="undefined">            dialog.close();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;, false);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div></li><li><p>秀米的文档里使用的是UE.registerUI(‘dialog’，fn）的方式动态在UE里添加一个秀米按钮并且在按钮里添加弹出弹框事件，但是这么做可能会影响到系统其他使用UE里的地方同样出现秀米图标，无法按需加载。所以我将此改进成在UE的前端配置中的toolbars数组里添加一个”xiumi”字符串即可展示出秀米的方式。步骤如下：</p><ul><li><p>添加一个秀米的图标并添加样式。在ueditor1_4_3_3/themes/default/images文件夹里放入一个<a href="https://beta-engage.gridsumdissector.com/wechat/mfe-wechat/static/ueditor1\_4\_3\_3/themes/default/images/xiumi-connect-icon.png" target="_blank" rel="noopener">秀米图标</a>;</p></li><li><p>在ueditor1_4_3_3/themes/default/css/ueditor.css 添加俩句样式</p>  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="CSS"><figure class="iseeu highlight /css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* xiumi-dialog */</span></span><br><span class="line"><span class="selector-class">.edui-default</span> <span class="selector-class">.edui-for-xiumi</span> <span class="selector-class">.edui-dialog-content</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(100vw - 60px) <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">90vh</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.edui-default</span> <span class="selector-class">.edui-for-xiumi</span> <span class="selector-class">.edui-icon</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">"../images/xiumi-connect-icon.png"</span>) <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">background-size</span>: contain;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>在ueditor.all.js修改代码。在iframeUrlMap对象里添加键值对’xiumi’: ‘~/xiumi-ue-dialog-v5.html’，这个和刚刚那个html存放的地方有关。在btnCmds数组里添加一个’xiumi’字符串，在dialogBtns对象中的ok数组里添加’xiumi’字符串。</p></li><li><p>最后在UE的前端配置里toolbars数组里添加’xiumi’,即可成功展示出秀米图标与秀米的弹框。</p></li></ul></li><li><p>在ueditor.config.js的xss过滤白名单whitList配置里，修改section参数。同时将设置是否抓取远程图片catchRemoteImageEnable设置为true。</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">section:[<span class="string">'class'</span>, <span class="string">'style'</span>],</span><br></pre></td></tr></table></figure></div></li><li><p>能成功弹出秀米的弹框，并且能将秀米里的模版成功勾选到本地的UE编辑器里，说明集成就成功了一半啦。</p></li></ol><h4 id="二、秀米域名的图片转存。"><a href="#二、秀米域名的图片转存。" class="headerlink" title="二、秀米域名的图片转存。"></a>二、秀米域名的图片转存。</h4><p>要完成秀米图片的转存，首先我们要先完成UE对复制过来的网络图片的转存，图片的转存分为img标签与背景图片的抓取与转存。</p><ol><li><p>设置抓取白名单catcherLocalDomain，在白名单里的地址，UE不会对其发起转存请求。可以使用两种方式设置：</p><ul><li>使用UE.utils.extend方法强制在UE实例化后设置  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UE.utils.extend(editor.options, &#123;</span><br><span class="line">       catcherLocalDomain: [<span class="string">'127.0.0.1'</span>, <span class="string">'localhost'</span>, <span class="string">"static-alpha-engage.gridsumdissector.com"</span>, <span class="string">"static-beta-engage.gridsumdissector.com"</span>, <span class="string">"static-uat-engage.gridsumdissector.com"</span>, <span class="string">"static.engage-all.com"</span>],</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure></div></li></ul><ul><li>修改ueditor.all.js里的初始配置代码，在这个js文件大概第8100行的地方，有一个loadServerConfig的函数，可以直接在这里将catcherLocalDomain的初始值设置为我们想要过滤的白名单域名。</li></ul></li><li><p>修改抓取图片的后端请求地址。UE发起所有接口请求都依赖于一个名为serverUrl的前端配置，然后通过使用serverUrl这个唯一的请求地址，通过GET参数action指定不同请求类型，比如uploadimage(执行上传图片或截图的action名称), uploadvideo(执行上传视频的action名称), catchimage(执行抓取远程图片的action名称)等等，但是后端为了方便接口的管理，一般会将接口拆分出来，当然UE也支持自定义请求地址。UE推荐的方法如下：</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;</span><br><span class="line">UE.Editor.prototype.getActionUrl = <span class="function"><span class="keyword">function</span>(<span class="params">action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (action == <span class="string">'uploadimage'</span> || action == <span class="string">'uploadscrawl'</span> || action == <span class="string">'uploadimage'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'http://a.b.com/upload.php'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action == <span class="string">'uploadvideo'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'http://a.b.com/video.php'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._bkGetActionUrl.call(<span class="keyword">this</span>, action);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ol><p>原理就是使用一个名为_bkGetActionUrl的临时变量承载原来的getActionUrl方法，然后重写getActionUrl方法，判断action的类型，来返回不同的接口，同时也还可以执行原来的getActionUrl方法。<br>但是我在使用这种方法的时候，会偶尔碰到内存溢出，导致上传图片功能不可用的原因，可能是getActionUrl在其他地方也被重新赋值了，产生循环引用该函数的问题。所以我依旧在ueditor.all.js里修改了getActionUrl原始函数，大概在第8040行代码里，判断getActionUrl函数内部一个actionName的参数，来返回你想要的接口名。</p><ol start="3"><li><p>到这里差不多能够抓取到img标签的src并且可以将其替换了，但需要注意俩点地方：</p><ul><li><p>注意抓取后，后端返回的数据格式时候和UE里源码设置的一样，在ueditor.all.js找到UE.plugins[‘catchremoteimage’]这个函数，在其内部执行catchremoteimage的success回掉函数的地方注意获取源路径和新路径的数据路径的地方。</p></li><li><p>UE内部有一个判断是否跨域的方法，如果跨域会使用jsonp的方式请求接口，如果你是本地调试，并且后端已经对跨域crose处理，不需要使用jsonp的方式请求，你可以把它关了。同样在UE.plugins[‘catchremoteimage’]这个函数里，找到定义catchremoteimage函数的地方，将其内部ajax请求的option里，将dataType固定设置为空字符串即可。</p></li></ul></li><li><p>除了img标签的src替换，背景图片也是需要进行图片抓取和替换的。其实就是依葫芦画瓢，看明白了UE是如何对img标签进行src替换的，也就明白该如何对背景图片进行替换了。</p><ul><li><p>首先你需要在ueditor.all.js文件的domUtils参数里新添一个方法getElementsByTagNameStyle。通过元素的style来获取元素节点数组。</p>  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 方法getElementsByTagNameStyle的封装</span></span><br><span class="line"><span class="comment">   * @method getElementsByTagNameStyle</span></span><br><span class="line"><span class="comment">   * @param &#123; e &#125; node 目标节点对象</span></span><br><span class="line"><span class="comment">   * @param &#123; t &#125; tagName 需要查找的节点的tagName， 多个tagName以空格分割</span></span><br><span class="line"><span class="comment">   * @param &#123; i &#125; style 节点对象的筛选条件</span></span><br><span class="line"><span class="comment">   * @return &#123; Array &#125; 符合条件的节点集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> getElementsByTagNameStyle: <span class="function"><span class="keyword">function</span> (<span class="params">e, t, i</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (i &amp;&amp; utils.isString(i)) &#123;</span><br><span class="line">         <span class="keyword">var</span> n = i;</span><br><span class="line">         i = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">var</span> t, i = n.split(<span class="string">","</span>), o = !<span class="number">0</span>, r = e.getAttribute(<span class="string">"style"</span>), a = <span class="number">0</span>; t = i[a++];) <span class="keyword">if</span> (!r || r.indexOf(t) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                 o = !<span class="number">1</span>;</span><br><span class="line">                 <span class="keyword">break</span></span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">return</span> o</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     t = utils.trim(t).replace(<span class="regexp">/[ ]&#123;2,&#125;/g</span>, <span class="string">" "</span>).split(<span class="string">" "</span>);</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> o, r = [], a = <span class="number">0</span>; o = t[a++];) <span class="keyword">for</span> (<span class="keyword">var</span> s, l = e.getElementsByTagName(o), d = <span class="number">0</span>; s = l[d++];) i &amp;&amp; !i(s) || r.push(s);</span><br><span class="line">     <span class="keyword">return</span> r</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure></div></li><li><p>在UE.plugins[‘catchremoteimage’]下的catchRemoteImage监听函数里添加代码。首先你得的到有背景图片的的元素节点数组。使用刚刚新添的方法</p>  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">backgroundimagestags = domUtils.getElementsByTagNameStyle(me.document, <span class="string">"section div p"</span>, <span class="string">"background,url"</span>)<span class="comment">//抓取背景图片所在的标签</span></span><br></pre></td></tr></table></figure></div><p>  然后将该元素节点数组里的图片地址都抽取出来，放在一个存放图片地址的数组里</p>  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> backgroundimages = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, backci; backci = backgroundimagestags[i++];) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> bstyle = backci.style;</span><br><span class="line">    <span class="keyword">var</span> backgroundimgurltag = bstyle[<span class="string">'background-image'</span>] || bstyle[<span class="string">'background'</span>] || <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span> (backgroundimgurltag != <span class="literal">null</span> &amp;&amp; backgroundimgurltag != <span class="string">""</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> backsrc = backgroundimgurltag.split(<span class="string">"("</span>)[<span class="number">1</span>].split(<span class="string">")"</span>)[<span class="number">0</span>].replace(<span class="regexp">/\"/g</span>, <span class="string">""</span>)</span><br><span class="line">                      || backgroundimgurltag.split(<span class="string">"("</span>)[<span class="number">1</span>].split(<span class="string">")"</span>)[<span class="number">0</span>].replace(<span class="regexp">/\"/g</span>, <span class="string">""</span>)</span><br><span class="line">                      || <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (backsrc != <span class="literal">null</span> &amp;&amp; backsrc != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="regexp">/^(https?|ftp):/i</span>.test(backsrc) &amp;&amp; !test(backsrc, catcherLocalDomain)) &#123;</span><br><span class="line">                backgroundimages.push(<span class="built_in">encodeURI</span>(backsrc));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>  最后依葫芦画瓢，对该图片地址数组循环，依次发起转存请求，并且将对应的节点内的背景图片url进行替换。</p>  <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(backgroundimages.length) &#123;</span><br><span class="line">          catchremoteimage(backgroundimages, &#123;</span><br><span class="line">              <span class="comment">//成功抓取</span></span><br><span class="line">              success: <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                      <span class="keyword">var</span> info = r.state !== <span class="literal">undefined</span> ? r:<span class="built_in">eval</span>(<span class="string">"("</span> + r.responseText + <span class="string">")"</span>);</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                      <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  <span class="comment">/* 获取源路径和新路径 */</span></span><br><span class="line">                  <span class="keyword">var</span> i, j, ci, cj, oldSrc, newSrc, styleText ,list = info.data.list;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">for</span> (i = <span class="number">0</span>; ci = backgroundimagestags[i++];) &#123;</span><br><span class="line">                      styleText = ci.getAttribute(<span class="string">"style"</span>);</span><br><span class="line">                      oldSrc = styleText;</span><br><span class="line">                      <span class="keyword">if</span> (oldSrc.indexOf(<span class="string">'url("'</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                          oldSrc = oldSrc.split(<span class="string">'url("'</span>)[<span class="number">1</span>].split(<span class="string">'")'</span>)[<span class="number">0</span>];</span><br><span class="line">                      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldSrc.indexOf(<span class="string">"url('"</span>) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                          oldSrc = oldSrc.split(<span class="string">"url('"</span>)[<span class="number">1</span>].split(<span class="string">"')"</span>)[<span class="number">0</span>];</span><br><span class="line">                      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                          <span class="keyword">if</span> (!(oldSrc.indexOf(<span class="string">"url("</span>) &gt; <span class="number">0</span>)) <span class="keyword">continue</span>;</span><br><span class="line">                          oldSrc = oldSrc.split(<span class="string">"url("</span>)[<span class="number">1</span>].split(<span class="string">")"</span>)[<span class="number">0</span>];</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">if</span> (oldSrc.indexOf(<span class="string">"?"</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                          oldSrc = oldSrc.split(<span class="string">"?"</span>)[<span class="number">0</span>];</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">for</span> (j = <span class="number">0</span>; cj = list[j++];) &#123;</span><br><span class="line">                          <span class="keyword">if</span> (oldSrc == cj.source &amp;&amp; <span class="string">"SUCCESS"</span> == cj.state) &#123;</span><br><span class="line">                              newSrc = catcherUrlPrefix + cj.url, styleText = styleText.replace(oldSrc, newSrc), domUtils.setAttributes(ci, &#123; <span class="attr">style</span>: styleText &#125;), domUtils.setAttributes(ci, &#123; <span class="attr">is_updata</span>: <span class="string">"true"</span> &#125;);</span><br><span class="line">                              <span class="keyword">break</span></span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                  me.fireEvent(<span class="string">'catchremotesuccess'</span>)</span><br><span class="line">              &#125;,</span><br><span class="line">              <span class="comment">//回调失败，本次请求超时</span></span><br><span class="line">              error: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                  me.fireEvent(<span class="string">"catchremoteerror"</span>);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></div></li></ul></li></ol><ol start="5"><li><p>到这里，UE对普通的img标签及背景图片的抓取与转存已经成功了，如果想要对秀米过来的图片进行转存需要注意以下俩点：</p><ul><li><p>对某些秀米图片地址的后缀进行处理，去掉?号之后类似?x-oss-process=所有的部分。这个在catchremoteimage函数里对imgs进行一步map循环，将？后面的东西去掉即可，同时注意在图片地址数组循环的过程中oldSrc？后面的内容也要去掉，否则oldSrc == cj.source &amp;&amp; “SUCCESS” == cj.state这一步判断不会通过，就无法进行图片地址的替换了。</p></li><li><p>从秀米回到本地UE编辑器的时候不会触发图片转存请求，这也是秀米文档埋下的一个坑！解决这个问题，你需要在xiumi-ue-dialog-v5.html文件里，在<code>dialog.close();</code>代码前添加一句<code>editor.fireEvent(&#39;afterpaste&#39;);</code>来主动触发afterpaste这个监听函数。</p></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;秀米集成到UEditor的配置过程&quot;&gt;&lt;a href=&quot;#秀米集成到UEditor的配置过程&quot; class=&quot;headerlink&quot; title=&quot;秀米集成到UEditor的配置过程&quot;&gt;&lt;/a&gt;秀米集成到UEditor的配置过程&lt;/h3&gt;&lt;p&gt;虽然秀米官方有提供文档说明如何将秀米插件集成至UEditor里(&lt;a href=&quot;http://hgs.xiumi.us/uedit/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;秀米官方文档&lt;/a&gt;)，但是该文档说明模糊不清，关键配置一句话带过，即使配置成功后还有坑留在里面。所以我重新整理了这个配置过程，回顾一下过程的同时也给以后需要用到的小伙伴提供便利。&lt;/p&gt;
    
    </summary>
    
      <category term="博客" scheme="http://blog.zijunfe.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
  </entry>
  
  <entry>
    <title>原型链的理解</title>
    <link href="http://blog.zijunfe.cn/2019/05/11/prototype/"/>
    <id>http://blog.zijunfe.cn/2019/05/11/prototype/</id>
    <published>2019-05-11T14:19:22.000Z</published>
    <updated>2019-05-13T05:34:57.853Z</updated>
    
    <content type="html"><![CDATA[<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[].__proto__ === <span class="built_in">Array</span>.prototype</span><br><span class="line"><span class="built_in">Array</span>.__proto__ === <span class="built_in">Function</span>.prototype</span><br><span class="line"><span class="built_in">Array</span>.prototype.__proto__ === <span class="built_in">Object</span>.prototype</span><br><span class="line"><span class="built_in">Function</span>.__proto__ === <span class="built_in">Function</span>.prototype <span class="comment">// Function.prototype 是个方法，是通过继承Object.prototype而产生的,</span></span><br><span class="line"><span class="built_in">Function</span>.__proto__.__proto__ === <span class="built_in">Object</span>.prototype <span class="comment">// Object.prototype 原型链顶端，是对象，但它不是通过Object函数创建的。是浏览器引擎按照ECMAScript规范创造的一个对象</span></span><br><span class="line"><span class="built_in">Object</span>.prototype.__proto__ === <span class="literal">null</span></span><br></pre></td></tr></table></figure></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;div class=&quot;highlight-wrap&quot;autocomplete=&quot;off&quot; autocorrect=&quot;off&quot; autocapitalize=&quot;off&quot; spellcheck=&quot;false&quot; contenteditable=&quot;true&quot;data-rel=&quot;JS&quot;&gt;
      
    
    </summary>
    
      <category term="JavaScript" scheme="http://blog.zijunfe.cn/categories/JavaScript/"/>
    
    
  </entry>
  
  <entry>
    <title>vue如何与TypeScript搭配使用</title>
    <link href="http://blog.zijunfe.cn/2019/05/07/vue-ts/"/>
    <id>http://blog.zijunfe.cn/2019/05/07/vue-ts/</id>
    <published>2019-05-07T09:02:38.000Z</published>
    <updated>2019-05-11T09:20:59.254Z</updated>
    
    <content type="html"><![CDATA[<p>最近真的陷入了TypeScript无法自拔，我甚至有一种感觉ts可能会成为前端必须要掌握的一项技术(就像现在前端从业者必须得掌握三大框架之一一样)。</p><p>但现在使用vue+TypeScript来开发项目的其实还是比较少的，<code>Vue</code>的作者尤雨溪在知乎上回答过这么一个问题<a href="https://www.zhihu.com/question/310485097/answer/591869966" target="_blank" rel="noopener">TypeScript 不适合在 vue 业务开发中使用吗？</a>,根据他本人的回答，现在的vue2.x版本对TS的支持是远不如React和Angular的，所以在即将发布的vue3.0要加强这一块。</p><p>但是因为<code>vue-class-component</code>与<code>vue-property-decorator</code>(前者的升级版本，加入了Vue，Watch，Emit等功能)的存在，现在使用TS+vue来写项目也不是什么问题，虽然还有些稍许的bug，不过无伤大雅</p><p>在前面的博客里我介绍过如何<a href="/2019/04/24/vuex/">使用TypeScript如何搭建store文件夹</a>，所以这篇博文主要做一个用JS与TS编写vue文件的区别。(引入的是<code>vue-property-decorator</code>，全部介绍完基本上是不可能的，这里结束的是平时用的多的)</p><a id="more"></a><h4 id="data-computed-methods"><a href="#data-computed-methods" class="headerlink" title="#data,computed,methods"></a>#data,computed,methods</h4><p>JS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name:<span class="string">'HelloWorld'</span>,</span><br><span class="line">    data()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            bar:<span class="string">'hello'</span>,</span><br><span class="line">            foo:<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed:&#123;</span><br><span class="line">        comBar()&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.bar+<span class="string">'world'</span></span><br><span class="line">        &#125;</span><br><span class="line">        comFoo:&#123;</span><br><span class="line">            <span class="keyword">get</span>:function()&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.foo+<span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">set</span>:function(newVal)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(newVal)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        handleFn()&#123;</span><br><span class="line">            <span class="comment">// ...do something</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>TS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Component,Vue&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    name:<span class="string">'HelloWorld'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> HelloWorld <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    bar:<span class="built_in">string</span> = <span class="string">'hello'</span>;</span><br><span class="line">    foo:<span class="built_in">number</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">get</span> comBar():<span class="built_in">string</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.bar + <span class="string">'world'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> comBar(val:<span class="built_in">string</span>)&#123;</span><br><span class="line">        <span class="comment">// 注意，这里不能标返回值类型，就算写void也不行</span></span><br><span class="line">        <span class="built_in">console</span>.log(val)</span><br><span class="line">    &#125;</span><br><span class="line">    handleFn():voids&#123;</span><br><span class="line">        <span class="comment">//...do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><blockquote><p><code>@Component({options})</code> 中接受的options就是传统的配置，<code>mixin</code>,自定义指令,子组件的注册都要在这里声明</p></blockquote><h4 id="watch"><a href="#watch" class="headerlink" title="#watch"></a>#watch</h4><p>JS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    watch:&#123;</span><br><span class="line">        <span class="string">'foo'</span>:&#123;</span><br><span class="line">            handler:<span class="function"><span class="keyword">function</span>(<span class="params">newVal,oldVal</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(newVal,oldVal)</span><br><span class="line">            &#125;,</span><br><span class="line">            deep:<span class="literal">true</span>, <span class="comment">// 开启深度监听</span></span><br><span class="line">            immediate:<span class="literal">true</span> <span class="comment">// 该回调(handler函数)将会在侦听开始之后被立即调用</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>TS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Vue,Watch,Component&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> HelloWorld <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    <span class="meta">@Watch</span>(<span class="string">'foo'</span>,&#123;deep:<span class="literal">true</span>,immediate:<span class="literal">true</span>&#125;)</span><br><span class="line">    onWatchFoo(newVal:<span class="built_in">string</span>,oldVal:<span class="built_in">string</span>)&#123;</span><br><span class="line">        <span class="comment">// 监听的方法名是可以自定义的</span></span><br><span class="line">        <span class="comment">// do something...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><h4 id="props-directives"><a href="#props-directives" class="headerlink" title="#props #directives"></a>#props #directives</h4><p>JS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name:<span class="string">'childComponent'</span>,</span><br><span class="line">    props:&#123;</span><br><span class="line">        bar:<span class="built_in">Boolean</span>,</span><br><span class="line">        foo:&#123;</span><br><span class="line">            type:<span class="built_in">String</span>,</span><br><span class="line">            defalut:<span class="string">'abc'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        obj:&#123;</span><br><span class="line">            type:<span class="built_in">Object</span>,</span><br><span class="line">            <span class="keyword">default</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> &#123;</span><br><span class="line">                    a:<span class="number">1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            required:<span class="literal">true</span> <span class="comment">// 定义该prop是否是必填项</span></span><br><span class="line">            validator:<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// 自定义验证函数 return出来一个boolean值</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.keys(values).includes(<span class="string">'a'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    directives:&#123;</span><br><span class="line">        focus:&#123;</span><br><span class="line">            inserted:<span class="function"><span class="keyword">function</span>(<span class="params">el,binding,vnode,oldVnode</span>)</span>&#123;</span><br><span class="line">                <span class="comment">// el:指令所绑定的元素，可以用来直接操作DOM</span></span><br><span class="line">                el.focus();</span><br><span class="line">                <span class="comment">// binding:一个对象，包括以下属性</span></span><br><span class="line">                <span class="comment">// name: 指令名--focus</span></span><br><span class="line">                <span class="comment">// value： 指令的绑定值，例如v-my-directives="1+1"中，value的值为2</span></span><br><span class="line">                <span class="comment">// oldValue：指令绑定的前一个值。仅在update和componentUpdated钩子中可用。无论值是否改变都可用</span></span><br><span class="line">                <span class="comment">// expression：字符串形式的指令表达式。例如v-my-directives="1+1"中，表达式为‘1+1’</span></span><br><span class="line">                <span class="comment">// arg：传给指令的参数，例如 v-my-directives:foo='...'中,参数为‘foo’</span></span><br><span class="line">                <span class="comment">// modifiers：一个包含修饰符的对象。例如：v-my-directives.stop.prevent中，修饰符对象为&#123;stop:true,prevent:true&#125;</span></span><br><span class="line">                <span class="keyword">let</span> &#123;name,value,oldValue,expression,arg,modifiers&#125; = binding;</span><br><span class="line">                <span class="comment">// vnode: Vue 编译生成的虚拟节点</span></span><br><span class="line">                <span class="comment">// oldVnode：上一个虚拟节点，仅在update和componentUpdated钩子中使用</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>TS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Vue,Component,Prop&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="comment">// 第一种你可以在在@Component里</span></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    props:&#123;</span><br><span class="line">        bar:&#123;</span><br><span class="line">            <span class="keyword">type</span>:<span class="built_in">Boolean</span>,</span><br><span class="line">            <span class="keyword">default</span>:<span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    directives:&#123;</span><br><span class="line">        focus:&#123;</span><br><span class="line">            inserted:<span class="function"><span class="keyword">function</span>(<span class="params">el,binding,vnode,oldvnode</span>)</span>&#123;</span><br><span class="line">                el.focus()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 第二种使用@Prop的方式</span></span><br><span class="line"><span class="keyword">interface</span> ObjProp &#123;</span><br><span class="line">    a:<span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> HelloWorld <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    <span class="meta">@Prop</span>(&#123;<span class="keyword">default</span>:<span class="literal">false</span>&#125;)</span><br><span class="line">    bar!:<span class="built_in">boolean</span> <span class="comment">//!: 表示强制解析，告诉ts我这里一定有值 如果没有写！，虽然不会报错但是代码会有红线提示</span></span><br><span class="line">    <span class="meta">@Prop</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">default</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;msg:<span class="string">'haha3'</span>&#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      required:<span class="literal">true</span>,</span><br><span class="line">      validator:<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.keys(value).includes(<span class="string">'a'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">    obj!:ObjProp</span><br><span class="line">    <span class="comment">// 好像直接写一个&#123;&#125;作为默认值也没问题</span></span><br><span class="line">    obj!:&#123;</span><br><span class="line">        a:<span class="built_in">number</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><h3 id="Model"><a href="#Model" class="headerlink" title="@Model"></a>@Model</h3><blockquote><p>前提条件，在父组件中，对子组件使用了<code>v-mode=&quot;checked&quot;</code></p></blockquote><p>父组件<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">checkbox</span> <span class="attr">v-mode</span>=<span class="string">"checked"</span> &gt;</span><span class="tag">&lt;/<span class="name">checkbox</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p><p>子组件<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">:checked</span>=<span class="string">"checked"</span> @<span class="attr">change</span>=<span class="string">"change"</span>/&gt;</span></span><br></pre></td></tr></table></figure></div></p><p>JS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子组件中</span></span><br><span class="line"><span class="keyword">export</span> defalut &#123;</span><br><span class="line">    <span class="comment">// model 参数为2.2.0新增，允许一个自定义组件在使用v-model时定制prop和event</span></span><br><span class="line">    model:&#123;</span><br><span class="line">        prop:<span class="string">"checked"</span>,</span><br><span class="line">        event:<span class="string">"change"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    props:&#123;</span><br><span class="line">        checked:<span class="built_in">Boolean</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        change:<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.$emit(<span class="string">'change'</span>,e.target.checked)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>TS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Vue,Component,Model,Emit&#125; <span class="keyword">from</span> <span class="string">"vue-property-decorator"</span>;</span><br><span class="line"><span class="meta">@Component</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> HelloWorld <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    <span class="meta">@Model</span>(<span class="string">'checked'</span>,&#123;<span class="keyword">type</span>:<span class="built_in">Boolean</span>&#125;)</span><br><span class="line">    checked!:<span class="built_in">boolean</span>,</span><br><span class="line">    <span class="meta">@Emit</span>(<span class="string">'change'</span>)</span><br><span class="line">    change(e:MouseEvent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><h3 id="Emit"><a href="#Emit" class="headerlink" title="@Emit"></a>@Emit</h3><p>父组件<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">add-component</span> @<span class="attr">on-add</span>=<span class="string">"addFunction"</span>&gt;</span><span class="tag">&lt;/<span class="name">add-component</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p><p>有一个可以做加减法的子组件,如下<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"onSub"</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">tepe</span>=<span class="string">"test"</span> <span class="attr">v-model</span>=<span class="string">"count"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"onAdd"</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p><p>JS写法</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            count:<span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    name:<span class="string">'addcomponent'</span>,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        onSub()&#123;</span><br><span class="line">            <span class="keyword">this</span>.$emit(<span class="string">'on-sub'</span>,<span class="keyword">this</span>.count)</span><br><span class="line">        &#125;,</span><br><span class="line">        onAdd()&#123;</span><br><span class="line">            <span class="keyword">this</span>.$emit(<span class="string">'on-add'</span>,<span class="keyword">this</span>.count)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>TS写法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Vue,Component,Emit&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    name:<span class="string">'addcomponent'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> AddComponent <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    count:numer = <span class="number">0</span>;</span><br><span class="line">    <span class="meta">@Emit</span>() <span class="comment">// 如果父组件传过来的方法是 on-add 那么，@Emit里可以省略方法名</span></span><br><span class="line">    onAdd()&#123;</span><br><span class="line">        <span class="keyword">this</span>.count += <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.count <span class="comment">// 通过return的方式，在父组件的方法中才能在event中拿到值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Emit</span>(<span class="string">'otherFnName'</span>)</span><br><span class="line">    onSub()&#123;</span><br><span class="line">        <span class="keyword">this</span>.count -=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><h3 id="Provide-Inject"><a href="#Provide-Inject" class="headerlink" title="@Provide @Inject"></a>@Provide @Inject</h3><p>通常<code>provide</code>与<code>inject</code>是配合使用的，一般使用在插件与组件库中，在父组件中通过<code>provide</code>提供一些数据，他的所有子组件，都能都通过<code>inject</code>注入到自己的组件中，并且通过<code>this</code>来调用。</p><blockquote><p><code>provide：Object | () =&gt; Object</code><br><code>inject：Array&lt;string&gt; | { [key: string]: string | Symbol | Object }</code></p></blockquote><p>JS用法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name:<span class="string">"father-component"</span>,</span><br><span class="line">    provide:&#123;</span><br><span class="line">        bar:<span class="number">1</span>,</span><br><span class="line">        foo:<span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 任意子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    inject:[<span class="string">'bar'</span>,<span class="string">'foo'</span>]</span><br><span class="line">    <span class="comment">// 如果需要定义默认值</span></span><br><span class="line">    inject:&#123;</span><br><span class="line">        bar:&#123;</span><br><span class="line">            <span class="keyword">default</span>:<span class="string">'heihei'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        foo1:&#123;</span><br><span class="line">            form:<span class="string">'foo'</span>, <span class="comment">// 声明从不同名字的属性注入</span></span><br><span class="line">            defalut:<span class="string">'haha'</span> <span class="comment">// 非原始属性，已工厂方法返回 ()=&gt;[1,2,3]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>TS用法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父组件</span></span><br><span class="line"><span class="keyword">import</span> &#123;Vue,Component,Provide&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Father <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    <span class="meta">@Provide</span>()</span><br><span class="line">    foo = <span class="string">"hello vue"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子组件</span></span><br><span class="line"><span class="keyword">import</span> &#123;Vue,Component,Inject&#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Child <span class="keyword">extends</span> Vue &#123;</span><br><span class="line">    <span class="meta">@Inject</span>()</span><br><span class="line">    foo !:<span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>综上所写，使用TS与使用JS编写vue文件的区别就全部罗列完了</p><p>但应该还有很多遗漏的点，如果你有什么补充，欢迎在留言区评论。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近真的陷入了TypeScript无法自拔，我甚至有一种感觉ts可能会成为前端必须要掌握的一项技术(就像现在前端从业者必须得掌握三大框架之一一样)。&lt;/p&gt;
&lt;p&gt;但现在使用vue+TypeScript来开发项目的其实还是比较少的，&lt;code&gt;Vue&lt;/code&gt;的作者尤雨溪在知乎上回答过这么一个问题&lt;a href=&quot;https://www.zhihu.com/question/310485097/answer/591869966&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;TypeScript 不适合在 vue 业务开发中使用吗？&lt;/a&gt;,根据他本人的回答，现在的vue2.x版本对TS的支持是远不如React和Angular的，所以在即将发布的vue3.0要加强这一块。&lt;/p&gt;
&lt;p&gt;但是因为&lt;code&gt;vue-class-component&lt;/code&gt;与&lt;code&gt;vue-property-decorator&lt;/code&gt;(前者的升级版本，加入了Vue，Watch，Emit等功能)的存在，现在使用TS+vue来写项目也不是什么问题，虽然还有些稍许的bug，不过无伤大雅&lt;/p&gt;
&lt;p&gt;在前面的博客里我介绍过如何&lt;a href=&quot;/2019/04/24/vuex/&quot;&gt;使用TypeScript如何搭建store文件夹&lt;/a&gt;，所以这篇博文主要做一个用JS与TS编写vue文件的区别。(引入的是&lt;code&gt;vue-property-decorator&lt;/code&gt;，全部介绍完基本上是不可能的，这里结束的是平时用的多的)&lt;/p&gt;
    
    </summary>
    
      <category term="Vue" scheme="http://blog.zijunfe.cn/categories/Vue/"/>
    
    
  </entry>
  
  <entry>
    <title>记第一次去深大</title>
    <link href="http://blog.zijunfe.cn/2019/05/05/diary1/"/>
    <id>http://blog.zijunfe.cn/2019/05/05/diary1/</id>
    <published>2019-05-05T07:54:30.000Z</published>
    <updated>2019-05-05T09:37:34.066Z</updated>
    
    <content type="html"><![CDATA[<p>期待很久的五一假期<br>已经过完了╥﹏╥…<br>不出意外的,大部分时间还是宅在家里玩游戏<br>为什么不想出门呢？<br><strong>第一:</strong> 比较反感去人多的地方<br><strong>第二:</strong> 这种天气宅着真的很舒服，如何形容呢，窗外下着忽大忽小的雨，家里蓝胖子又在沙发上打盹，温度适合穿着单薄的羽织，无论是窝在被子里，还是在游戏世界里激情厮杀都很舒服，玩累了就抱着蓝胖子一顿狂撸，不得不说惬意十分了。<br><a id="more"></a></p><div style="width:300px;margin:0 auto;"><img src="/2019/05/05/diary1/cat.png" alt="猫猫"></div><br><p style="text-align:center;font-size:10px;color:#666">总是在睡觉的蓝胖子</p><br>然鹅…<br>总是在家里宅着，身上会长蘑菇吧<br><br>于是，选了个不下雨的下午，起身去了深圳大学。离家里不远，2站地铁就到了，步行10分钟，就能到深大的北门。<br><br>也许第一次来，也许不是深大的学生，我踏进大门后居然有点点紧张(我也不知道我紧张个锤子)<br><br>因为深大就在深南大道的路边，不同于马路上呼啸而过的汽车，深大就显得很安静，让人一下就放松下来，假期的校园没有什么人，但有不少带小孩过来散步的家庭。<br><br>沿着大路往下走，左拐进入了一个田径场，去观众席上坐着，看着田径场上跑步的陌生人，我陷入了自己大学生活的回忆中，记忆中我离开大学的最后一件事也是像这样，坐在观众席上，看着跑步的陌生人发呆。何曾几时，我也是校园里无忧无虑的一名学子。真怀念那段时光讷…<br><div style="width:600px;margin:0 auto;"><img src="/2019/05/05/diary1/playground.png" alt="操场"></div><br><p style="text-align:center;font-size:10px;color:#666">深大北门的田径场</p><br><br>离开了田径场，随便挑选一条路，继续往下走，深大的绿化做的真的不错，有路的地方旁边一定有树。<br><div style="width:400px;margin:0 auto;"><img src="/2019/05/05/diary1/img1.png" alt="小路"></div><br><p style="text-align:center;font-size:10px;color:#666">不知名的小路1</p><br><br>在这里上学一定很辛福吧，每条路都很适合闲暇时光的闲逛。(当年咋就不加点油，考个深大呢！)<br><div style="width:400px;margin:0 auto;"><img src="/2019/05/05/diary1/img2.png" alt="小路"></div><br><p style="text-align:center;font-size:10px;color:#666">不知名的小路2</p><br><br>然后，在乱走一通后，路过了深大的宿舍楼，在宿舍楼下发现了一只花不溜秋的小猫，和他的小食堂。小猫当时似乎在草丛里上厕所…真的非常不好意思偷拍了你…<br><div style="width:400px;margin:0 auto;"><br><img src="/2019/05/05/diary1/img3.png" alt="小猫"><br><img src="/2019/05/05/diary1/img4.png" alt="小猫"><br></div><br><p style="text-align:center;font-size:10px;color:#666">小花猫和他的食堂</p><br><br>继续往下走还看到了一只非常漂亮的小白猫，忘记拍照了，真可惜。相比外面的小野猫，深大的猫咪似乎都不怎么怕人，猫咪们能在深大生活也是一件幸运的事吧，毕竟照顾他们的都是一群心善的年轻人。<br><br>漫无目的的继续走，好像来到了深大的图书馆，从外面看建筑比较老式的了，没有进去看，偶尔有学生进出，果然每个学校都有学霸即使在假期还继续在图书馆里奋斗。汉京集团的大楼就矗立在不远处，那几个 “I love SZ”大字，从这个角度看好像显的更加年轻呢。<br><div style="width:600px;margin:0 auto;"><img src="/2019/05/05/diary1/img5.png" alt="图书馆"></div><br><p style="text-align:center;font-size:10px;color:#666">图书馆</p><br><br>离开了图书馆后，步行来到了一个人工湖的旁边，这里男女成双出现的概率大了许多，不得不说，每个学校的人工湖都是小情侣们的约会圣地，风景漂亮，散步在湖边的小路上说说笑笑，都是爱情的样子。比较惊讶的是，这里有很多黑天鹅。上回见到黑天鹅还是几年前去厦大的时候，难道黑天鹅和名校是标配吗？<br><div style="width:600px;margin:0 auto;"><img src="/2019/05/05/diary1/img6.png" alt="人工湖"></div><br><p style="text-align:center;font-size:10px;color:#666">深大的湖</p><br><div style="width:600px;margin:0 auto;"><img src="/2019/05/05/diary1/img7.png" alt="黑天鹅"></div><br><p style="text-align:center;font-size:10px;color:#666">黑天鹅</p><br><br>在人工湖旁的凉亭坐了一会，心里想着这个季节是大学毕业生们拍摄毕业照，喝毕业酒的时候吧。真好呢。<br><br>深大真的很美，也很安静。适合散步放松心情。<br><br>然后天差不多要黑了，起身拍了拍屁股上的灰，就寻路回家了。<br><br>——————<em>我是分割线</em>——————<br><br>怀念过往像香烟一样，会让人沉迷。<br><br>所以，不要在过往中无法自拔，也不要割断自己的过往。将美好的过往像美酒一样密封，常年埋藏在地下。或在夜深的时候，或在孤身一人的时候，或在疲惫于生活的时候，将美酒拿出，取其一瓢，慢慢品尝。<br><br>所以，偶尔怀念过往，让自己的灵魂暂时脱离这个车水马龙的世界，回到那段最珍贵的时光，回到那些最难忘的人们的身旁，一起嬉笑，一起挥霍时光。<br><br><div style="text-align:center;font-weight:bold;font-size:24px;">如果有时光机，你最想回到哪段时光呢？</div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;期待很久的五一假期&lt;br&gt;已经过完了╥﹏╥…&lt;br&gt;不出意外的,大部分时间还是宅在家里玩游戏&lt;br&gt;为什么不想出门呢？&lt;br&gt;&lt;strong&gt;第一:&lt;/strong&gt; 比较反感去人多的地方&lt;br&gt;&lt;strong&gt;第二:&lt;/strong&gt; 这种天气宅着真的很舒服，如何形容呢，窗外下着忽大忽小的雨，家里蓝胖子又在沙发上打盹，温度适合穿着单薄的羽织，无论是窝在被子里，还是在游戏世界里激情厮杀都很舒服，玩累了就抱着蓝胖子一顿狂撸，不得不说惬意十分了。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="生活" scheme="http://blog.zijunfe.cn/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
  </entry>
  
  <entry>
    <title>看懂vue源码-理解数据双向绑定的实现</title>
    <link href="http://blog.zijunfe.cn/2019/04/29/vue-databind/"/>
    <id>http://blog.zijunfe.cn/2019/04/29/vue-databind/</id>
    <published>2019-04-29T08:31:47.000Z</published>
    <updated>2019-04-30T08:09:32.933Z</updated>
    
    <content type="html"><![CDATA[<p>如果你是一名前端从业者，并且在简历上写了会使用vue框架，那么在拿着这份简历去面试的时候，面试官有很大的概率会问你vue的数据双向绑定是如何实现的。<br>打开goole，输入vue双向绑定，有非常多优秀的博主已经对vue数据双向绑定作了一个全方位的刨析，阅读之后，你会大概了解，双向绑定涉及到javascript的核心api是<code>Object.defineProperty</code>,通过<code>set</code>与<code>get</code>这俩个存取描述符来监听数据的实时改变，并且在对模版作出相应改变。<br>那么为了更加了解vue是如何实现数据双向绑定的，我花了一下午的时间阅读vue的源码，并将我的对vue实现数据双向绑定的方式理解记录了下来。<br><a id="more"></a></p><h4 id="打开vue源码目录"><a href="#打开vue源码目录" class="headerlink" title="打开vue源码目录"></a>打开vue源码目录</h4><p><img src="/2019/04/29/vue-databind/vue1.jpg" alt="vue源码目录"><br>这几个文件夹都是分别负责什么的，我们暂且不管(<del>其实是我不知道</del>),我们找到入口文件<code>src/core/index.js</code>。<br>看到一大推第一次见并且不熟的代码，谁都会感动头疼。所以我看源码的基本方针是</p><blockquote><ul><li>不清楚应用方法的具体实现，先靠他的命名猜一下(所以英文好很关键，哭)。</li><li>如果有一大堆<code>if..else-if..else</code>,先找到按正常流程走的代码,其他分支先放一放…</li><li>不用钻牛角尖，看的懂的代码就好好理解，看不懂的了解个大概足已！看源码的目的是更好的理解框架的实现原理，并不是要把整个框架吃透(<del>关键也吃不透啊，vue源代码那么多，咱也不是啥大神，难道看不懂去问尤雨溪吗，咱也不敢问讷</del>)</li></ul></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/index.js</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'./instance/index'</span> <span class="comment">//从Vue这个关键词来看，这个应该是vue的核型方法</span></span><br><span class="line"><span class="keyword">import</span> &#123; initGlobalAPI &#125; <span class="keyword">from</span> <span class="string">'./global-api/index'</span> <span class="comment">// 初始化全局API？</span></span><br><span class="line"><span class="keyword">import</span> &#123; isServerRendering &#125; <span class="keyword">from</span> <span class="string">'core/util/env'</span> <span class="comment">// 判断是不是ssr？</span></span><br><span class="line"><span class="keyword">import</span> &#123; FunctionalRenderContext &#125; <span class="keyword">from</span> <span class="string">'core/vdom/create-functional-component'</span></span><br><span class="line"><span class="comment">// 调用方法咯，初始化全局变量</span></span><br><span class="line">initGlobalAPI(Vue)</span><br><span class="line"><span class="comment">// 给vue原型添加$isServer属性 --当前 Vue 实例是否运行于服务器。</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(Vue.prototype, <span class="string">'$isServer'</span>, &#123;</span><br><span class="line">  <span class="keyword">get</span>: isServerRendering</span><br><span class="line">&#125;)</span><br><span class="line">// 给vue原型添加$ssrContext 不认识这玩意</span><br><span class="line">Object.defineProperty(Vue.prototype, '$ssrContext', &#123;</span><br><span class="line">  <span class="keyword">get</span> () &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore next */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$vnode &amp;&amp; <span class="keyword">this</span>.$vnode.ssrContext</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不认识</span></span><br><span class="line"><span class="comment">// expose FunctionalRenderContext for ssr runtime helper installation</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(Vue, <span class="string">'FunctionalRenderContext'</span>, &#123;</span><br><span class="line">  value: FunctionalRenderContext</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Vue.version = <span class="string">'__VERSION__'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Vue</span><br></pre></td></tr></table></figure></div><p>我就是以上面这种方式来一点点看源码的。根据上面得到的提示，我们应该去看看<code>./instance/index</code>里写了啥。<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/index</span></span><br><span class="line"><span class="keyword">import</span> &#123; initMixin &#125; <span class="keyword">from</span> <span class="string">'./init'</span></span><br><span class="line">...</span><br><span class="line">initMixin(Vue)</span><br><span class="line">...</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Vue</span><br></pre></td></tr></table></figure></div></p><p>其他初始化函数我们先不看，从<code>initMixin</code>这个名字和第一个引入的骄傲位置来说，他应该和我们要找的<code>data</code>属性有一腿。所以我们打开<code>./init</code>看一下。<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/init</span></span><br><span class="line"><span class="keyword">import</span> &#123; initState &#125; <span class="keyword">from</span> <span class="string">'./state'</span></span><br><span class="line">...</span><br><span class="line">initState(vm)</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div></p><p>从命名上来讲，<code>state</code>应该是与<code>data</code>联系更多的，也许是因为在react里，初始化数据就叫作<code>state</code>吧，所以我们打开<code>./state</code>找到<code>initState</code>方法<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/state</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initState</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._watchers = [] <span class="comment">// 看起来像清空一个观察者队列</span></span><br><span class="line">  <span class="keyword">const</span> opts = vm.$options</span><br><span class="line">  <span class="keyword">if</span> (opts.props) initProps(vm, opts.props) <span class="comment">// 初始化props参数</span></span><br><span class="line">  <span class="keyword">if</span> (opts.methods) initMethods(vm, opts.methods) <span class="comment">// 初始化methods参数</span></span><br><span class="line">  <span class="keyword">if</span> (opts.data) &#123;</span><br><span class="line">    initData(vm) <span class="comment">// 如果有data参数，初始化data参数</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    observe(vm._data = &#123;&#125;, <span class="literal">true</span> <span class="comment">/* asRootData */</span>) <span class="comment">// 如果没有，触发observe方法(这个方法很关键！)，给一个&#123;&#125;作为默认值并且作为rootdata</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (opts.computed) initComputed(vm, opts.computed) <span class="comment">// 初始化computed参数</span></span><br><span class="line">  <span class="keyword">if</span> (opts.watch &amp;&amp; opts.watch !== nativeWatch) &#123;</span><br><span class="line">      <span class="comment">// watch存在并且 这个watch不是Firefox(火狐浏览器)在Object.prototype上有一个“监视”功能,初始化</span></span><br><span class="line">    initWatch(vm, opts.watch)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>从上面的代码中，我们看到很多脸熟的代码了，并且终于找到我们想找的<code>data</code>属性，顺水推舟继续往下走吧，找到<code>initData</code>的方法定义。<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initData</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data = vm.$options.data</span><br><span class="line">  data = vm._data = <span class="keyword">typeof</span> data === <span class="string">'function'</span></span><br><span class="line">    ? getData(data, vm)</span><br><span class="line">    : data || &#123;&#125;</span><br><span class="line">    <span class="comment">// 判断data是不是个函数，如果时执行getData（往一个targetStack push进去？）</span></span><br><span class="line">  <span class="keyword">if</span> (!isPlainObject(data)) &#123;</span><br><span class="line">    <span class="comment">// isPlainObject判断data是不是个对象</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">      <span class="string">'data functions should return an object:\n'</span> +</span><br><span class="line">      <span class="string">'https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function'</span>,</span><br><span class="line">      vm</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// proxy data on instance</span></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(data)</span><br><span class="line">  <span class="keyword">const</span> props = vm.$options.props</span><br><span class="line">  <span class="keyword">const</span> methods = vm.$options.methods</span><br><span class="line">  <span class="keyword">let</span> i = keys.length</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="comment">// 判断data里定义的key是否与methods和props的冲突</span></span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (methods &amp;&amp; hasOwn(methods, key)) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">`Method "<span class="subst">$&#123;key&#125;</span>" has already been defined as a data property.`</span>,</span><br><span class="line">          vm</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (props &amp;&amp; hasOwn(props, key)) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">        <span class="string">`The data property "<span class="subst">$&#123;key&#125;</span>" is already declared as a prop. `</span> +</span><br><span class="line">        <span class="string">`Use prop default value instead.`</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isReserved(key)) &#123;</span><br><span class="line">      proxy(vm, <span class="string">`_data`</span>, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// observe data</span></span><br><span class="line">  observe(data, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>到这里，我们已经很接近实现数据双向绑定的函数了，那就<code>observe</code>，接下来去<code>../observer/index</code>里看看，<code>observe</code>函数到底写了些什么东西。<br>在<code>export function observe()</code>的函数里，return出来的是一个名为<code>Observer</code>的类<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  value: any;</span><br><span class="line">  dep: Dep;</span><br><span class="line">  vmCount: number; <span class="comment">// number of vms that have this object as root $data</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span> (value: any) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value</span><br><span class="line">    <span class="keyword">this</span>.dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="keyword">this</span>.vmCount = <span class="number">0</span></span><br><span class="line">    def(value, <span class="string">'__ob__'</span>, <span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (hasProto) &#123;</span><br><span class="line">        protoAugment(value, arrayMethods)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        copyAugment(value, arrayMethods, arrayKeys)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.observeArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.walk(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Walk through all properties and convert them into</span></span><br><span class="line"><span class="comment">   * getter/setters. This method should only be called when</span></span><br><span class="line"><span class="comment">   * value type is Object.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  walk (obj: <span class="built_in">Object</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">      defineReactive(obj, keys[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Observe a list of Array items.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  observeArray (items: <span class="built_in">Array</span>&lt;any&gt;) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = items.length; i &lt; l; i++) &#123;</span><br><span class="line">      observe(items[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>当我们调用<code>new Oberver(value)</code>的时候，会执行<code>this.walk(value)</code>这个方法，看方法里的作用应该是，遍历<code>value</code>,执行<code>defineReactive</code>方法，而在<code>defineReactive</code>方法里主要就是通过<code>Object.defineProperty</code>方法来定义响应式数据。<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params"> obj: Object,</span></span></span><br><span class="line"><span class="function"><span class="params"> key: string,</span></span></span><br><span class="line"><span class="function"><span class="params"> val: any,</span></span></span><br><span class="line"><span class="function"><span class="params"> customSetter?: ?Function,</span></span></span><br><span class="line"><span class="function"><span class="params"> shallow?: boolean</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">get</span>: function reactiveGetter () &#123;</span><br><span class="line">        ...</span><br><span class="line">        dep.depend()</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="keyword">set</span>: function reactiveSetter (newVal) &#123;</span><br><span class="line">        ...</span><br><span class="line">        dep.notify()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></p><p>省略了部分代码后，我们注意到在<code>get</code>和<code>set</code>里分别执行了<code>dep.depend()</code>和<code>dep.notify()</code>,而<code>Dep</code>就是我们常说的订阅发布管理中心，这时候我们来看一张，vue实现数据双向绑定的示例图。<br><img src="/2019/04/29/vue-databind/vue2.png" alt="数据双向绑定的示例图"><br>大概解释一下上图，上图实现的设计模式为 订阅-发布 模式。可以从俩个入口分别说起</p><blockquote><p><strong>1.</strong>从<code>init Data</code>说起，比如我们在vue实例中定义了初始化的<code>data</code>属性，接着会触发<code>new Observer()</code>,<code>data</code>里所有的数据都会通过上面介绍的那样，通过<code>defineReactive</code>这个方法为每一个属性挂载<code>Object.defineProperty</code>(也可以说在<code>get</code>里为每一个属性都添加了一个订阅，在<code>set</code>里做一个通知订阅者的操作),如果触发了<code>setter</code>，也就是在业务代码里改变了<code>data</code>里的值，会通知<code>Watcher</code>，<code>Wathcer</code>更新指令系统对应绑定的<code>data</code>值<br><strong>2.</strong>从编译侧说起，Dom 上通过指令或者双大括号绑定的数据，经过编译以后，会为数据进行添加观察者<code>Watcher</code>，当实例化<code>Watcher</code>的时候 会触发属性的<code>getter</code>方法，此时会调用<code>dep.depend()</code>，并且会将<code>Watcher</code>的依赖收集起来。</p></blockquote><p>那么我们可以看一下<code>dep.depend()</code>和<code>dep.depend()</code><br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/dep.js</span></span><br><span class="line">  depend () &#123;</span><br><span class="line">    <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">      Dep.target.addDep(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notify () &#123;</span><br><span class="line">    <span class="comment">// stabilize the subscriber list first</span></span><br><span class="line">    <span class="keyword">const</span> subs = <span class="keyword">this</span>.subs.slice()</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !config.async) &#123;</span><br><span class="line">      <span class="comment">// subs aren't sorted in scheduler if not running async</span></span><br><span class="line">      <span class="comment">// we need to sort them now to make sure they fire in correct</span></span><br><span class="line">      <span class="comment">// order</span></span><br><span class="line">      subs.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.id - b.id)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = subs.length; i &lt; l; i++) &#123;</span><br><span class="line">      subs[i].update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div></p><p>首先我们得先知道注入到<code>Dep</code>里的一般都是<code>Watcher</code>类，像<code>Dep.target.addDep(this)</code>和<code>subs[i].update()</code>这俩个方法是可以在定义<code>Watcher</code>的文件下找到的。<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/observer/watcher.js</span></span><br><span class="line">  addDep (dep: Dep) &#123;</span><br><span class="line">    <span class="keyword">const</span> id = dep.id</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.newDepIds.has(id)) &#123;</span><br><span class="line">      <span class="keyword">this</span>.newDepIds.add(id)</span><br><span class="line">      <span class="keyword">this</span>.newDeps.push(dep)</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.depIds.has(id)) &#123;</span><br><span class="line">        dep.addSub(<span class="keyword">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  update () &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.lazy) &#123;</span><br><span class="line">      <span class="keyword">this</span>.dirty = <span class="literal">true</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.sync) &#123;</span><br><span class="line">      <span class="keyword">this</span>.run()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      queueWatcher(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div></p><p>一系列操作的主要作用就是让<code>Dep</code>与<code>Wathcer</code>建立双向的联系。</p><p><del>代码真是太多了，解释不完，感觉要烂尾了</del></p><p>最后vue有一个很关键的指令解析系统，在<code>src/compiler/directives</code>文件中可以找到<code>v-bind</code>,<code>v-on</code>,<code>v-model</code>相应的源码。能力有限，看不下去了。越挖越深。</p><p><del>说的我自己都乱了</del></p><p>言简意赅的总结一下，<code>Observer</code>就是对<code>data</code>里到所有值进行一个数据劫持，强行给每个数据注入<code>set</code>(能监听到数据改变，没有<code>return</code>)与<code>get</code>(该数据具体呈现出来的值，能<code>return</code>出数据)方法，<code>Observer</code>操作完以后，<code>data</code>可以理解成房子资源。然后<code>Dep</code>是个订阅器（订阅管理中心，可以理解成房地产中介），<code>Watcher</code>是订阅者(有钱买房的人)，<code>Watcher</code>把需求和联系方式通过<code>dep.depend()</code>告诉中介<code>dep</code>，<code>dep</code>中介找到了合适的房子通过<code>dep.notify()</code>打电话通知我们忽悠买房。那<code>Wathcer</code>没有钱之前就是被绑定在dom上的一些数据，通过了<code>v-model</code>,<code>v-test</code>,双大括号等途径赚到了钱（也就是vue的compile编译系统），升级成了一个<code>Wathcer</code>，赚钱和买房总是无穷无尽的，dom发生了更新（比如input事件），赚到钱了就去问中介<code>dep</code>有没有房，同时如果房源发生了变化（data发生了更新），中介<code>dep</code>会通知<code>Wathcer</code>买房不?</p><div style="text-align:center;font-weigth:bold;font-size:20px;">最后祝大家早日能买到房。</div><br><div style="width:200px;margin:0 auto;"><img src="/2019/04/29/vue-databind/vue3.jpg" alt="自闭"></div>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;如果你是一名前端从业者，并且在简历上写了会使用vue框架，那么在拿着这份简历去面试的时候，面试官有很大的概率会问你vue的数据双向绑定是如何实现的。&lt;br&gt;打开goole，输入vue双向绑定，有非常多优秀的博主已经对vue数据双向绑定作了一个全方位的刨析，阅读之后，你会大概了解，双向绑定涉及到javascript的核心api是&lt;code&gt;Object.defineProperty&lt;/code&gt;,通过&lt;code&gt;set&lt;/code&gt;与&lt;code&gt;get&lt;/code&gt;这俩个存取描述符来监听数据的实时改变，并且在对模版作出相应改变。&lt;br&gt;那么为了更加了解vue是如何实现数据双向绑定的，我花了一下午的时间阅读vue的源码，并将我的对vue实现数据双向绑定的方式理解记录了下来。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Vue" scheme="http://blog.zijunfe.cn/categories/Vue/"/>
    
    
  </entry>
  
  <entry>
    <title>加深了解vuex及使用typescript如何搭建store文件夹</title>
    <link href="http://blog.zijunfe.cn/2019/04/24/vuex/"/>
    <id>http://blog.zijunfe.cn/2019/04/24/vuex/</id>
    <published>2019-04-24T06:49:41.000Z</published>
    <updated>2019-04-29T06:00:53.085Z</updated>
    
    <content type="html"><![CDATA[<p>自从使用vue作为项目开发框架后，vue的全家桶每天都会与我见面，其中vuex更是常客。对于专门作为vue的状态管理模式，我认为这应该是每一位前端从业者都必须深入掌握的一项技能，可是在这段时间的面试中，我问了一些vuex相关的知识，却很少有人回答全面，即使他们的简历上写了3-4年的从业经验。比如以下这些vuex最基础的问题。<br><a id="more"></a></p><ul><li><p>如何调用store.js里的<code>Mutation</code>与<code>Actions</code>里定义的方法？</p><blockquote><p>大部分人回答的都是以通过<code>this.$store.commit</code>或者<code>this.$store.dispatch</code>这种通过调用vue实例中的<code>$store</code>的方式，而且只知道这一种调用方法。其实还有两种方式:1.通过<code>import store from &#39;store.js&#39;</code>的方式引入文件，通过<code>store.commit</code>和<code>store.dispatch</code>的方式调用。2.使用<code>mapActions</code>,<code>mapMutation</code>等辅助函数将组件的methods映射为store对应的方法名。</p></blockquote></li><li><p>使用过vuex的<code>module</code>概念吗？在<code>.vue</code>文件中如何使用<code>module</code>里的<code>Mutation</code>与<code>Actions</code>里定义的方法？</p><blockquote><p>这个基本上就全军覆没了，仅知道vuex有这么一个概念，但项目中没有用过，所以对于模块化的store不了解。<br>对于vuex的<code>module</code>概念，其实真的不难，个人觉得，即使项目中没有用过，但vuex作为我们日常开发中的老朋友，认真了解一下他5个孩子<code>State,Getter,Mutation,Action,Module</code>，从时间成本上来说，也许一个晚上就可以搞定，即使现在项目中使用不到，那未来的项目再碰到至少不会措手不及吧。</p></blockquote></li></ul><p>从以上俩个基础问题可以看出，很多前端对vuex的学习并不深入，觉得能在项目中使用就可以了，毕竟代码不是浮现在页面上的东西，只要功能能正确实现，很少有人对你的代码会有兴趣。这怎么说呢，多少是有点道理的，但是对知识的追求不该止步于实现功能这一步，既然尤雨溪开源了vue这么好的前端框架，如果我们不更加深入了解vuex，是不是对别人的知识成果不尊重呢？</p><h4 id="Vuex到底是什么东西？"><a href="#Vuex到底是什么东西？" class="headerlink" title="Vuex到底是什么东西？"></a>Vuex到底是什么东西？</h4><p>在说vuex之前，可以先了解一下Flux与Redux。每一位前端对<a href>MVC框架</a>与<a href>MVVM框架</a>都不陌生，如果略显遗忘，可以参考阮一峰老师的对这几个框架的<a href="http://www.ruanyifeng.com/blog/2015/02/mvcmvp_mvvm.html" target="_blank" rel="noopener">解释</a>,简单来说Flux是一种架构思想，专门解决软件的结构问题，而Redux则是将Flux与函数式编程结合在一起,使收Flux启发的简介版Flux。<del>其实这些概念都不重要，随便百度一下就好啦︿(￣︶￣)︿</del><br>按照官方的说法Vuex 是一个专为 Vue.js 应用程序开发的状态管理模式。它采用集中式存储管理应用的所有组件的状态，并以相应的规则保证状态以一种可预测的方式发生变化。<br>按照惯例放一张官方的图<br><img src="/2019/04/24/vuex/vuex1.jpg" alt="vuex结构图"><br>vuex的五个核心概念<code>State,Getter,Mutation,Action,Module</code>,基本用法我就不再一一列举了，参考<a href="https://vuex.vuejs.org/zh/guide/state.html" target="_blank" rel="noopener">vue官网</a>一定比我介绍的详细。</p><hr><p>以下只介绍一些我个人对这几个概念中比较少用的知识点的罗列。</p><h5 id="State"><a href="#State" class="headerlink" title="State"></a>State</h5><ul><li>如何获取模块内的state<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    computed:&#123;</span><br><span class="line">        ...mapState([&#123;</span><br><span class="line">            count:<span class="function"><span class="params">state</span>=&gt;</span>state.moduleName.count</span><br><span class="line">        &#125;])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">or</span><br><span class="line"><span class="keyword">this</span>.$store.state.moduleName.count</span><br></pre></td></tr></table></figure></div></li></ul><h5 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h5><ul><li>如何使用mapState, mapGetters, mapActions 和 mapMutations 这些函数来绑定带命名空间的模块。</li></ul><blockquote><p>在辅助函数第一个参数可以填模块名</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...mapGetters(<span class="string">'moduleName'</span>,[<span class="string">'foo'</span>,<span class="string">'bar'</span>])</span><br><span class="line">...mapActions(<span class="string">'moduleName'</span>,[<span class="string">'fn1'</span>,<span class="string">'fn2'</span>])</span><br></pre></td></tr></table></figure></div><blockquote><p>使用 createNamespacedHelpers 创建基于某个命名空间辅助函数</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; mapState, mapActions &#125; = createNamespacedHelpers(<span class="string">'moduleName'</span>)</span><br><span class="line">...mapGetters(<span class="string">'moduleName'</span>,[<span class="string">'foo'</span>,<span class="string">'bar'</span>])</span><br><span class="line">...mapActions(<span class="string">'moduleName'</span>,[<span class="string">'fn1'</span>,<span class="string">'fn2'</span>])</span><br></pre></td></tr></table></figure></div><blockquote><p>通过<code>this.$store</code>调用,比如现在模块名叫child</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$store.getters[<span class="string">'child/foo'</span>]</span><br><span class="line"><span class="keyword">this</span>.$store.commit(<span class="string">'child/addCount'</span>,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">this</span>.$store.dispatch(<span class="string">'child/fn'</span>,data)</span><br></pre></td></tr></table></figure></div><ul><li><p>在带命名空间的模块内访问全局内容</p><p>getters有四个参数<code>state,getters,rootState,rootGetters</code>,后面两个是全局内容。<br>actions第一个参数是个object，他里面包含<code>{ dispatch, commit, getters, rootGetters }</code>，最后一个是全局内容。<br>在actions里如果要分发 action 或提交 mutation，将 <code>{ root: true }</code> 作为第三参数传给 dispatch 或 commit 即可。</p></li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dispatch(<span class="string">'someOtherAction'</span>, <span class="literal">null</span>, &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;) <span class="comment">// -&gt; 'someOtherAction'</span></span><br><span class="line">commit(<span class="string">'someMutation'</span>, <span class="literal">null</span>, &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;) <span class="comment">// -&gt; 'someMutation'</span></span><br></pre></td></tr></table></figure></div><ul><li>在带命名空间的模块注册全局 action<br>若需要在带命名空间的模块注册全局 action，你可添加 root: true，并将这个 action 的定义放在函数 handler 中。</li></ul><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// module/child.js</span></span><br><span class="line">    actions: &#123;</span><br><span class="line">        someAction: &#123;</span><br><span class="line">          root: <span class="literal">true</span>,</span><br><span class="line">          handler (&#123; dispatch, commit, getters, rootGetters &#125;, payload) &#123; ... &#125; <span class="comment">// -&gt; 'someAction'</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></div><hr><h4 id="使用Typescript开发的项目如何写vuex的store文件夹"><a href="#使用Typescript开发的项目如何写vuex的store文件夹" class="headerlink" title="使用Typescript开发的项目如何写vuex的store文件夹"></a>使用Typescript开发的项目如何写vuex的store文件夹</h4><p>这个就有意思啦，既然选择了ts代替了js，那么ts的一些特性就要使用起来，于是我写了一个demo。<br>下图是我demo的文件结构，有木有觉得分的很清晰，很详细，哈哈。其中list是一个模块。<br><img src="/2019/04/24/vuex/ts1.jpg" alt="文件目录"><br>接下来就一个一个文件看过去吧。</p><ul><li><code>index.ts</code> store的对外暴露文件<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line">    <span class="keyword">import</span> Vuex ,&#123;StoreOptions&#125;<span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">    <span class="keyword">import</span> &#123;RootState&#125; <span class="keyword">from</span> <span class="string">'./type'</span>;</span><br><span class="line">    <span class="keyword">import</span> &#123;todolist&#125; <span class="keyword">from</span> <span class="string">'./module/list/index'</span>;</span><br><span class="line">    Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> store: StoreOptions&lt;RootState&gt; = &#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        version:<span class="string">'1.0.0'</span></span><br><span class="line">    &#125;, <span class="comment">//注册全局state</span></span><br><span class="line">    getters:&#123;&#125;, <span class="comment">//注册全局getters</span></span><br><span class="line">    mutations: &#123;&#125;, <span class="comment">//注册全局mutations</span></span><br><span class="line">    actions: &#123;&#125;, <span class="comment">//注册全局actions</span></span><br><span class="line">    modules:&#123;</span><br><span class="line">        todolist</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store&lt;RootState&gt;(store);</span><br></pre></td></tr></table></figure></div></li></ul><blockquote><p>如果你对<code>StoreOptions&lt;RootState&gt;</code>这种写法有疑问，你可以参考vuex的源代码，在<code>vuex/types/index.d.ts</code>文件中有相关介绍。并且你需要了解ts的泛型与类型变量。</p></blockquote><ul><li><p><code>type.ts</code> 暴露全局state的接口，如果要新添state，要提前在这里定义类型，因为类型检查器会检查接口里的属性</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> RootState &#123;</span><br><span class="line">    version: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p><code>module/list/index.ts</code> store模块list的对外暴露文件</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;Module&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ListState&#125; <span class="keyword">from</span> <span class="string">'./type'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;getters&#125; <span class="keyword">from</span> <span class="string">'./getters'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;mutations&#125; <span class="keyword">from</span> <span class="string">'./mutations'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;actions&#125; <span class="keyword">from</span> <span class="string">'./actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;RootState&#125; <span class="keyword">from</span> <span class="string">'../../type'</span></span><br><span class="line"><span class="keyword">const</span> namespaced:<span class="built_in">boolean</span> = <span class="literal">true</span>; <span class="comment">//开启命名空间</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> state:ListState = &#123;</span><br><span class="line">    listArr:[],</span><br><span class="line">    foo:<span class="string">'hello'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> todolist:Module&lt;ListState,RootState&gt; = &#123;</span><br><span class="line">    namespaced,</span><br><span class="line">    state,</span><br><span class="line">    getters,</span><br><span class="line">    mutations,</span><br><span class="line">    actions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ul><blockquote><p>如果你对<code>namespaced</code>有疑问，可以参看vue的官网对命名空间的解释，<a href="https://vuex.vuejs.org/zh/guide/modules.html" target="_blank" rel="noopener">点我</a></p></blockquote><ul><li><p><code>module/list/type.ts</code> 暴露模块list的state的接口。</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> ListState &#123;</span><br><span class="line">    listArr ?: <span class="built_in">any</span>[],</span><br><span class="line">    foo ?: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p><code>module/list/getters.ts</code> 暴露模块list的getters参数。</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;GetterTree&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ListState&#125; <span class="keyword">from</span> <span class="string">'./type'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;RootState&#125; <span class="keyword">from</span> <span class="string">'../../type'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getters:GetterTree&lt;ListState,RootState&gt; = &#123;</span><br><span class="line">    bar(state,getters,rootState,rootGetters): <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state.foo+<span class="string">' world'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p><code>module/list/mutations.ts</code> 暴露模块list的mutation参数。</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;MutationTree&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ListState&#125; <span class="keyword">from</span> <span class="string">'./type'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> mutations:MutationTree&lt;ListState&gt;=&#123;</span><br><span class="line">    addFuHao(state,payload:<span class="built_in">string</span>)&#123;</span><br><span class="line">        state.foo += payload</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p><code>module/list/actions.ts</code> 暴露模块list的actions参数。</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;ActionTree&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ListState&#125; <span class="keyword">from</span> <span class="string">'./type'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;RootState&#125; <span class="keyword">from</span> <span class="string">'../../type'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> actions:ActionTree&lt;ListState,RootState&gt;=&#123;</span><br><span class="line">    fetchData(&#123;commit,dispatch,getters,rootGetters&#125;,payload):<span class="built_in">any</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            commit(<span class="string">'addFuHao'</span>,<span class="string">'!!!!'</span>)</span><br><span class="line">        &#125;,<span class="number">3000</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    rootActionTestFn:&#123; <span class="comment">//注册全局action</span></span><br><span class="line">        root:<span class="literal">true</span>,</span><br><span class="line">        handler(...a):<span class="built_in">any</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'触发了rootActionTestFn'</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(a)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ul><blockquote><p>一般来说模块内是很少嵌套子模块的，除非项目特别要求。如果需要，照葫芦画瓢就好啦。</p></blockquote><ul><li>那么定义好了store,如何使用呢？主要使用的是<code>vuex-class</code>。参考以下代码<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TS"><figure class="iseeu highlight /ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, Vue &#125; <span class="keyword">from</span> <span class="string">'vue-property-decorator'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;State, Getter ,Mutation,Action&#125; <span class="keyword">from</span> <span class="string">'vuex-class'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;ListState&#125; <span class="keyword">from</span> <span class="string">'../store/module/list/type'</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">namespace</span>:<span class="built_in">string</span> = <span class="string">'todolist'</span>; <span class="comment">//这里要注意，名称需要和模块暴露出来的参数名保持一致</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">    name:<span class="string">'todolist'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> ToDoList <span class="keyword">extends</span> Vue&#123;</span><br><span class="line">    <span class="meta">@State</span>(<span class="string">'list'</span>) list:<span class="built_in">any</span>;</span><br><span class="line">    <span class="meta">@Getter</span>(<span class="string">'bar'</span>,&#123;<span class="keyword">namespace</span>&#125;) bar:<span class="built_in">any</span>;</span><br><span class="line">    <span class="meta">@Mutation</span>(<span class="string">'addFuHao'</span>,&#123;<span class="keyword">namespace</span>&#125;) addFuHao:<span class="built_in">any</span>;</span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">'fetchData'</span>,&#123;<span class="keyword">namespace</span>&#125;) fetchData:<span class="built_in">any</span>; <span class="comment">//引入模块list的action</span></span><br><span class="line">    <span class="meta">@Action</span>(<span class="string">'rootActionTestFn'</span>) rootActionTestFn:<span class="built_in">any</span>; <span class="comment">//引入全局action</span></span><br><span class="line"></span><br><span class="line">    mounted() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.bar)</span><br><span class="line">        <span class="keyword">this</span>.fetchData();</span><br><span class="line">        <span class="keyword">this</span>.addFuHao();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自从使用vue作为项目开发框架后，vue的全家桶每天都会与我见面，其中vuex更是常客。对于专门作为vue的状态管理模式，我认为这应该是每一位前端从业者都必须深入掌握的一项技能，可是在这段时间的面试中，我问了一些vuex相关的知识，却很少有人回答全面，即使他们的简历上写了3-4年的从业经验。比如以下这些vuex最基础的问题。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Vue" scheme="http://blog.zijunfe.cn/categories/Vue/"/>
    
    
  </entry>
  
  <entry>
    <title>Nginx初体验</title>
    <link href="http://blog.zijunfe.cn/2019/04/20/nginx/"/>
    <id>http://blog.zijunfe.cn/2019/04/20/nginx/</id>
    <published>2019-04-20T09:48:24.000Z</published>
    <updated>2019-04-29T06:00:53.085Z</updated>
    
    <content type="html"><![CDATA[<p>  在有了自己的服务器后，不好好玩玩Nginx怎么行呢！<del>毕竟花了钱的</del><br>正好之前在学习<code>TypeScript</code>的时候，自己在github上有一个项目，所以想把这个项目丢到线上去玩玩～<br>目标: 将github上的项目丢进服务器，并且能够正确访问 <a href="http://www.zijunfe.cn" target="_blank" rel="noopener">www.zijunfe.cn</a>;<br>前端要学习的东西真的很多，不过我们的征途是星辰大海！<br><del>学习使我秃头</del></p><a id="more"></a><h4 id="如何在CentOS服务器里下载Nginx"><a href="#如何在CentOS服务器里下载Nginx" class="headerlink" title="如何在CentOS服务器里下载Nginx"></a>如何在CentOS服务器里下载Nginx</h4><ol><li><p>下载<code>epel-release</code></p><blockquote><p>EPEL (Extra Packages for Enterprise Linux)是基于Fedora的一个项目，为“红帽系”的操作系统提供额外的软件包，适用于RHEL、CentOS和Scientific Linux.</p></blockquote> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release</span><br></pre></td></tr></table></figure></div></li><li><p>下载nginx</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install nginx</span><br></pre></td></tr></table></figure></div></li><li><p>Nginx 开机启动</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure></div><blockquote><p>Systemctl是一个systemd工具，主要负责控制systemd系统和服务管理器。<br>Nginx 关闭开机启动</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">关闭开机启动 Nginx</span><br></pre></td></tr></table></figure></div></li><li><p>启动 Nginx</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nginx</span><br></pre></td></tr></table></figure></div></li></ol><ol start="5"><li><p>检查 Nginx 的运行状态</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status nginx</span><br></pre></td></tr></table></figure></div></li><li><p>如果你的服务器开启了防火墙，则需要同时打开 80（HTTP）和 443（HTTPS）端口,通过下面的命令来打开这两个端口：</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --zone=public --add-service=http</span><br><span class="line">sudo firewall-cmd --permanent --zone=public --add-service=https</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure></div></li><li><p>验证 Nginx 是否成功启动，可以在浏览器中打开 <a href="http://YOUR_IP，您将看到默认的" target="_blank" rel="noopener">http://YOUR_IP，您将看到默认的</a> Nginx 欢迎页面</p></li><li><p>停止Nginx</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop nginx</span><br></pre></td></tr></table></figure></div></li></ol><ol start="9"><li><p>重启Nginx</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></div></li><li><p>修改 Nginx 配置后，重新加载</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure></div></li></ol><h5 id="如何免密登陆服务器"><a href="#如何免密登陆服务器" class="headerlink" title="如何免密登陆服务器"></a>如何免密登陆服务器</h5><ol><li>把自己电脑的私钥复制出来，例如在mac里私钥在<code>～/.ssh/*.pub</code>文件里，如果没有私钥和公钥，可以先生成，如何生成，执行<code>ssh-keygen</code>,一路回车。</li><li>登陆服务器，把刚刚复制的私钥放入 服务器<code>~/.ssh/authorized_keys</code>文件中</li><li>执行命令<code>ssh-add k id_rsa</code>,<code>id_rsa</code>就是那个以<code>.pub</code>结尾的文件名，如果执行报错，则先执行命令<code>ssh-agent bashen</code>,再执行添加命令</li><li>进入服务器只需要执行<code>ssh root@ip地址</code>就能免密登陆啦！</li></ol><h5 id="如何添加nginx代理文件"><a href="#如何添加nginx代理文件" class="headerlink" title="如何添加nginx代理文件"></a>如何添加nginx代理文件</h5><ol><li>在<code>etc/nginx/conf.d</code>中新增以<code>.conf</code>结尾的配置文件，比如你的域名叫做<code>zijunfe.cn</code>，那最好新增的文件名就叫<code>zijunfe-cn.conf</code>作为文件名。</li><li><p><code>vim *.conf</code>进入文件，添加配置，如下：</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"> listen 80;</span><br><span class="line"> server_name www.zijunfe.cn;</span><br><span class="line"> root /www/typescript-project/dist;</span><br><span class="line"> index index.html;</span><br><span class="line"> location ~* ^.+\.(jpg|jpeg|gif|png|ico|css|js|pdf|txt)&#123;</span><br><span class="line">  root /www/typescript-project/dist;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p> 保存退出。</p></li><li>执行命令<code>nginx -t</code>看看配置有没有报错，执行<code>nginx -s reload</code>重启nginx服务。</li><li>如果执行完以上操作后发现访问网址没有变化，可以在访问<code>etc/nginx/nginx.conf</code>文件，找到<code>include /usr/share/nginx/modules/*.conf;</code>,将它放到文件最后，然后重新启动nginx服务。</li></ol><h5 id="如何在服务器上下载nodejs"><a href="#如何在服务器上下载nodejs" class="headerlink" title="如何在服务器上下载nodejs"></a>如何在服务器上下载nodejs</h5><ol><li><p>在服务器上找一个文件夹，比如在<code>/</code>新建<code>app</code>文件夹</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir app &amp;&amp; cd app</span><br></pre></td></tr></table></figure></div></li><li><p>下载对应版本的nodejs版本，我的服务器系统centos，也就是Linux 64位的，nodejs建议下载稳定版本，在<code>app</code>文件夹里执行命令。</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://nodejs.org/dist/v10.14.2/node-v10.14.2-linux-x64.tar.xz</span><br></pre></td></tr></table></figure></div></li><li><p>解压文件夹</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf node-v10.14.2-linux-x64.tar.xz</span><br></pre></td></tr></table></figure></div></li><li><p>为了美观，对解压后的文件夹进行改名</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv node-v10.14.2-linux-x64 nodejs</span><br></pre></td></tr></table></figure></div></li><li><p>建立node,npm软连接</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /app/nodejs/bin/node /usr/local/bin/node</span><br><span class="line">sudo ln -s /app/nodejs/bin/npm /usr/local/bin/npm</span><br></pre></td></tr></table></figure></div></li><li><p>检查是否安装成功，执行<code>node -v</code>，如果有版本号，则安装成功，如果报错，看一下是不是建立软连接的时候，对应的路径有没有写正确。</p></li></ol><p>未完待续</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;  在有了自己的服务器后，不好好玩玩Nginx怎么行呢！&lt;del&gt;毕竟花了钱的&lt;/del&gt;&lt;br&gt;正好之前在学习&lt;code&gt;TypeScript&lt;/code&gt;的时候，自己在github上有一个项目，所以想把这个项目丢到线上去玩玩～&lt;br&gt;目标: 将github上的项目丢进服务器，并且能够正确访问 &lt;a href=&quot;http://www.zijunfe.cn&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;www.zijunfe.cn&lt;/a&gt;;&lt;br&gt;前端要学习的东西真的很多，不过我们的征途是星辰大海！&lt;br&gt;&lt;del&gt;学习使我秃头&lt;/del&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Nginx" scheme="http://blog.zijunfe.cn/categories/Nginx/"/>
    
    
  </entry>
  
  <entry>
    <title>面试</title>
    <link href="http://blog.zijunfe.cn/2019/04/12/interview/"/>
    <id>http://blog.zijunfe.cn/2019/04/12/interview/</id>
    <published>2019-04-12T01:57:39.000Z</published>
    <updated>2019-05-12T14:06:42.915Z</updated>
    
    <content type="html"><![CDATA[<p> 这两天面试了一些前端同行，面试别人同样是宝贵的经验，因为在问别人的同时，自己也会思考，这题的答案是什么，除了这种解法还有没有其他解法呢？所以这篇博文，我把自己问的问题作一个归纳与总结，并分为三个层次，<strong>基础</strong>，<strong>提升</strong>，<strong>高级</strong>，并且写一些比较冷门的前端知识。</p><a id="more"></a><h3 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h3><h4 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h4><h5 id="vue-rouer有几种模式，区别是什么？"><a href="#vue-rouer有几种模式，区别是什么？" class="headerlink" title="vue-rouer有几种模式，区别是什么？"></a><code>vue-rouer</code>有几种模式，区别是什么？</h5><blockquote><p>两种模式，hash模式与history模式 ，<code>vue-router</code>默认使用hash模式，hash模式的url格式一般为<code>http://.../#/...</code>,history模式则没有<code>/#/</code>，并且history模式需要后端配合，因为vue一般写的是单页面应用，如果后端没有正确的配置，用户直接访问<code>http://oursite.com/user/id</code>则回提示404错误。</p></blockquote><h5 id="vue-router路由传参有几种方法？"><a href="#vue-router路由传参有几种方法？" class="headerlink" title="vue-router路由传参有几种方法？"></a><code>vue-router</code>路由传参有几种方法？</h5><blockquote><p>通过<code>params</code>或<code>query</code>传参，前者参数不在url上显示，刷新页面会丢失参数，后者会在url上显示，刷新页面不会丢失参数。<br>路由的动态传参，这种方式首先要在<code>router.js</code>中配置路由对应的path为<code>{ path: &#39;/user/:id&#39;, component: User }</code>这种格式，在对应得页面可以通过<code>this.$route.params</code>来获取对应的参数。</p></blockquote><h5 id="vue-router的导航守卫有哪些？"><a href="#vue-router的导航守卫有哪些？" class="headerlink" title="vue-router的导航守卫有哪些？"></a><code>vue-router</code>的导航守卫有哪些？</h5><blockquote><p>前置守卫:<code>router.beforeEach</code>(常用)当一个导航触发时，全局前置守卫按照创建顺序调用<br>解析守卫:<code>router.beforeResolve</code>(不常用)与前置守卫相识，区别在于导航被确认之前，同时在所有组件内守卫和异步路由组件被解析之后，解析守卫就被调用。<br>后置守卫:<code>router.afterEach</code>(不常用)不会接受 next 函数也不会改变导航本身：<br>独享守卫:<code>beforeEnter</code>(不常用)在路由配置里定义，用来对单独的路由作处理<br>守卫一般有三个参数</p><ol><li><code>to:Route</code>:即将要进入的目标 路由对象</li><li><code>from: Route</code>:当前导航正要离开的路由</li><li><code>next: Function</code>:必须调用的跳转方法，否则不会进行路由跳转</li></ol></blockquote><h5 id="简单介绍一下vue-的生命周期函数？"><a href="#简单介绍一下vue-的生命周期函数？" class="headerlink" title="简单介绍一下vue 的生命周期函数？"></a>简单介绍一下vue 的生命周期函数？</h5><blockquote><p><strong>beforeCreate</strong>: 初始化之前的函数，vue实例不可访问，data未定义，一个基本不怎么用的函数<br><strong>created</strong>: 初始化函数，data已被定义，可以访问data里的数据，可以进行绑定，判断是否有<code>el</code>选项，有则继续进行，没有则停止编译(生命周期停止)，直到在该vue实例上调用vm.$mount(el)。接着判断是否有<code>template</code>选项，如果有，则会将<code>template</code>作为模板编译成render函数，如果没有，则将外部HTML作为模板编译。如果同时存在，<code>template</code>模版优先级是高于外部HTML的。同时vue对象中还有一个<code>render</code>函数，以createElement作为参数，然后做渲染操作，而且我们可以直接嵌入JSX，这个优先级是最高的。综上所述，模版优先级：<code>render</code>函数&gt;<code>template</code>模版&gt;外部HTML。<br><strong>beforeMount</strong>: 给vue添加$el成员，并且替换挂载的DOM元素。建立虚拟dom，data还是以参数名的方式挂载在节点中，没有注入数据。<br><strong>mounted</strong>: 第一次对组件进行渲染，将data里的数据注入节点中,这时已经形成了真实dom。这个函数vue的整个生命周期中只会执行一次，如果还有数据的变化，只会触发updated相关函数。<br><strong>beforeUpdate</strong>: 检测到data发生变化，准备对相应的组件再次渲染。首先重新渲染虚拟dom，再对真实的dom打补丁。<br><strong>updated</strong>: 完成对data发生变化的对应组件渲染<br><strong>beforeDestory</strong>: 实例销毁之前调用。在这一步，实例仍然完全可用。<br><strong>destoryed</strong>: 在Vue 实例销毁后调用。调用后，Vue 实例指示的所有东西都会解绑定，所有的事件监听器会被移除，所有的子实例也会被销毁。<br><strong>帖一张官方的生命周期图</strong><br><img src="/2019/04/12/interview/vue.png" alt="生命周期"></p></blockquote><h5 id="vuex的核心概念包括哪些内容。内容比较多，详情看vuex官网"><a href="#vuex的核心概念包括哪些内容。内容比较多，详情看vuex官网" class="headerlink" title="vuex的核心概念包括哪些内容。内容比较多，详情看vuex官网"></a><code>vuex</code>的核心概念包括哪些内容。内容比较多，详情看<a href="https://vuex.vuejs.org/zh/guide/modules.html" target="_blank" rel="noopener">vuex官网</a></h5><blockquote><p><code>state</code>:存放状态数据的字段，辅助函数<code>mapState</code><br><code>getter</code>:可以认为是 store 的计算属性,辅助函数<code>mapGetter</code><br><code>mutation</code>:更改store状态的唯一方法，必须是同步操作，辅助函数<code>mapMutation</code><br><code>action</code>:action类似于mutation,不过无法直接变更状态，需要通过提交mutation来更改，可以包含任意的异步操作，辅助函数<code>mapAction</code><br><code>module</code>:store的模块，每个模块拥有自己的state、mutation、action、getter、甚至是嵌套子模块。通过设置<code>namespaced: true</code>的方式使其成为带命名空间的模块，如果需要在带命名空间的模块访问全局内容，<code>rootState</code> 和 <code>rootGetter</code> 会作为第三和第四参数传入 getter，若需要在全局命名空间内分发 <code>action</code> 或提交 <code>mutation</code>，将 <code>{ root: true }</code> 作为第三参数传给 <code>dispatch</code> 或 <code>commit</code> 即可。</p></blockquote><h3 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h3><h4 id="基础篇-1"><a href="#基础篇-1" class="headerlink" title="基础篇"></a>基础篇</h4><h5 id="说一些与Array相关的api，并且挑几个详细说明它们的作用？"><a href="#说一些与Array相关的api，并且挑几个详细说明它们的作用？" class="headerlink" title="说一些与Array相关的api，并且挑几个详细说明它们的作用？"></a>说一些与<code>Array</code>相关的api，并且挑几个详细说明它们的作用？</h5><blockquote><p><code>concat</code>: 合并两个或多个数组，不会改变原数组，返回一个新数组<br><code>every</code>: 测试数组所有元素是否通过制定函数的测试<br><code>some</code>: 测试数组是否存在元素是否通过制定函数的测试<br><code>forEach</code>: 对数组的每个元素执行一次提供的函数。<br><code>reduce</code>:对数组中的每个元素执行一个由您提供的reducer函数(升序执行)，将其结果汇总为单个返回值。第一个参数为执行函数，第二个参数为执行函数第一次调用时它第一个参数的值<br><code>map</code>: 创建一个新数组，结果为该数组每个元素调用函数的结果<br><code>filter</code>: 过滤，创建一个新数组, 其包含通过所提供函数实现的测试的所有元素。<br><code>entries</code>: 返回一个新的Array Iterator对象，该对象包含数组中每个索引的键/值对。<br><code>find</code>: 返回数组中满足提供的测试函数第一个元素的值<br><code>findIndex</code>: 返回数组中满足提供的测试函数第一个元素的索引，没有返回-1<br><code>flat</code>: 按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回。（IE不支持该方法）<br><code>includes</code>: 判断一个数组是否包含一个指定的值<br><code>concat</code>: 合并两个或多个数组，不会改变原数组，返回一个新数组<br><code>join</code>: 将一个数组（或一个类数组对象）的所有元素连接成一个字符串并返回这个字符串。如果数组只有一个项目，那么将返回该项目而不使用分隔符。<br><code>splice</code>: 通过删除或替换现有元素来修改数组,并以数组形式返回被修改的内容。此方法会改变原数组。三个参数，start(指定下标)，deleteCount(移除的个数),[item1,item2,…]从start位置开始插入的元素。<br><code>slice</code>: 返回一个新的数组对象，这一对象是一个由 begin和 end（不包括end）决定的原数组的浅拷贝。原始数组不会被改变。<br><code>reverse</code>: 倒序<br><code>sort</code>: 排序<br><code>push</code>,<code>pop</code>,<code>shift</code>,<code>unshift</code> 数组堆栈操作</p></blockquote><h5 id="js的基础类型有哪些？"><a href="#js的基础类型有哪些？" class="headerlink" title="js的基础类型有哪些？"></a>js的基础类型有哪些？</h5><blockquote><p>String,Boolean,Number,Object,Undefined,Null,Symbol</p></blockquote><h5 id="var-let-const三种声明变量的方式有什么区别？"><a href="#var-let-const三种声明变量的方式有什么区别？" class="headerlink" title="var,let,const三种声明变量的方式有什么区别？"></a><code>var</code>,<code>let</code>,<code>const</code>三种声明变量的方式有什么区别？</h5><blockquote><p><code>var</code> 声明变量有变量提升的功能 能重复声明<br><code>let</code> 声明一个具有块级作用域的变量，不具备变量提升功能，重复声明会报错<br><code>const</code> 声明一个具有块级作用域的常量，并且常用大写字母作为变量名，不具备变量提升功能，重复声明会报错，重新赋值也会报错</p></blockquote><h4 id="提升篇"><a href="#提升篇" class="headerlink" title="提升篇"></a>提升篇</h4><h5 id="Object-assign-方法只会拷贝源对象自身并且可枚举的属性到目标对象，那么如何拷贝不可枚举的属性和继承属性呢？"><a href="#Object-assign-方法只会拷贝源对象自身并且可枚举的属性到目标对象，那么如何拷贝不可枚举的属性和继承属性呢？" class="headerlink" title="Object.assign()方法只会拷贝源对象自身并且可枚举的属性到目标对象，那么如何拷贝不可枚举的属性和继承属性呢？"></a><code>Object.assign()</code>方法只会拷贝源对象自身并且可枚举的属性到目标对象，那么如何拷贝不可枚举的属性和继承属性呢？</h5><p>首先说一下如何拷贝不可枚举的属性。<br>何为不可枚举属性，其实对象里每一个键值对都有6个配置选项。比如<code>obj = {a:1}</code>这样的数据结构，他是与<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">'a'</span>,&#123;</span><br><span class="line">    configurable:<span class="literal">true</span>, <span class="comment">// 该属性的描述符是否能被改变</span></span><br><span class="line">    enumerable:<span class="literal">true</span>, <span class="comment">// 该属性是否可枚举</span></span><br><span class="line">    value: <span class="number">1</span> <span class="comment">// 数据描述符  该属性对应的值</span></span><br><span class="line">    writeable: <span class="literal">true</span> <span class="comment">// 数据描述符  value是否能被赋值运算符改变</span></span><br><span class="line">    <span class="comment">// 数据描述符与存取描述符不可同时存在</span></span><br><span class="line">    <span class="comment">// get:function()&#123;return aValue&#125;,  // 一个给属性提供getter的方法，当访问该属性时，该方法会被执行</span></span><br><span class="line">    <span class="comment">// set:function(newValue)&#123;aValue = newValue&#125; // 一个给属性提供setter的方法，当值修改时，触发执行该方法</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></div></p><p>当设置了属性的<code>enumerable</code>为<code>false</code>时，这条属性就是不可枚举属性，即无法通过<code>for..in..</code>与<code>Object.keys()</code>获取到<br>首先你得通过<code>Object.getOwnPropertyNames(obj)</code>(能获取到不可枚举的属性的键名，但是获取不到以Symbol作为键名的属性)或者<code>Reflect.ownKeys(obj)</code>(获取到所有属性的键名)的方法获取到包括不可枚举属性的一个数组。<br>然后循环这个数组，通过<code>Object.getOwnPropertyDescriptor(obj,propkey)</code>的方法得知每一个属性的描述符，然后筛选出<code>enumerable:false</code>的属性，重新通过<code>Object.definePropertires(newObj,{&#39;propkey1&#39;:{...},&#39;propkey2&#39;:{...}})</code>的方式放入新的obj里，其他可枚举的属性通过<code>Object.assign({},obj1,...,objn)</code>的方式放入就好了。<br>至于继承属性的问题，可以通过<code>Object.getPrototypeOf(obj)</code>的方式获取指定对象的原型，然后设置新数组的<code>__proto__</code>为这个原型。问题就解决了。<br>当然有一种更好的方法。<br>配合使用<code>Object.create()</code>可用达到同样的目的<br><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> newObj = <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.getPrototypeOf(obj),<span class="built_in">Object</span>.getOwnPropertyDescriptors(obj))</span><br><span class="line"><span class="keyword">let</span> target = <span class="built_in">Object</span>.assign(&#123;&#125;,newObj,newObj1,...,newObjN)</span><br></pre></td></tr></table></figure></div></p><h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="基础篇-2"><a href="#基础篇-2" class="headerlink" title="基础篇"></a>基础篇</h4><h5 id="display-none与visibility-hidden与opacity-0-兼容写法filter：alpha-opacity-0-的区别"><a href="#display-none与visibility-hidden与opacity-0-兼容写法filter：alpha-opacity-0-的区别" class="headerlink" title="display:none与visibility:hidden与opacity:0(兼容写法filter：alpha(opacity=0))的区别?"></a><code>display:none</code>与<code>visibility:hidden</code>与<code>opacity:0</code>(兼容写法<code>filter：alpha(opacity=0)</code>)的区别?</h5><blockquote><p>他们都能让元素消失不见。<code>display:none</code>会让元素从渲染树中消失，渲染时不占任何空间，从而达到消失的目的。<code>visibility:hidden</code>与<code>opacity:0</code>只是让元素不可见，元素不会从渲染树消失不见，继续占据空间。<br><code>display:none</code>是非继承属性，元素直接消失了，修改子孙节点属性无法显示。<code>visibility:hidden</code>是继承属性，通过修改子孙属性<code>visibility:visible</code>可以让子孙节点<strong>显示</strong>。<br><code>opacity:0</code>，消失的原理是将元素的透明度设置为0，是继承属性，子孙节点通过设置<code>opacity:1</code><strong>无法显示</strong>，可以继续触发元素上绑定的事件。<br>修改元素的display通常会造成文档的回流，修改visibility与opacity属性只会造成本元素的重绘。</p></blockquote><h3 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h3><h4 id="基础篇-3"><a href="#基础篇-3" class="headerlink" title="基础篇"></a>基础篇</h4><h5 id="对手机号做加密处理，将中间四位数字用-代替"><a href="#对手机号做加密处理，将中间四位数字用-代替" class="headerlink" title="对手机号做加密处理，将中间四位数字用*代替"></a>对手机号做加密处理，将中间四位数字用<code>*</code>代替</h5><ol><li><p><code>replace</code>方法</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phone.replace(<span class="regexp">/(?&lt;=.&#123;3&#125;).(?=.&#123;4&#125;)/g</span>,<span class="string">'*'</span>)</span><br></pre></td></tr></table></figure></div></li><li><p><code>substring</code>方法,或<code>substr</code>方法</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phone.substring(<span class="number">0</span>,<span class="number">3</span>)+<span class="string">'****'</span>+phone.substring(<span class="number">6</span>,<span class="number">4</span>)</span><br><span class="line"><span class="comment">//or</span></span><br><span class="line">phone.substr(<span class="number">0</span>,<span class="number">3</span>)+<span class="string">'****'</span>+phone.substr(<span class="number">-4</span>)</span><br></pre></td></tr></table></figure></div></li><li><p>数组<code>splice</code>方法</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr=phone.split();arr.splice(<span class="number">3</span>,<span class="number">4</span>,<span class="string">'****'</span>);arr.join(<span class="string">''</span>)</span><br></pre></td></tr></table></figure></div></li></ol><h5 id="处理金钱字符串，例如‘1234567’-gt-’1-234-567’"><a href="#处理金钱字符串，例如‘1234567’-gt-’1-234-567’" class="headerlink" title="处理金钱字符串，例如‘1234567’=&gt;’1,234,567’"></a>处理金钱字符串，例如‘1234567’=&gt;’1,234,567’</h5><ol><li><p>正则法</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.replace(<span class="regexp">/\B(?=(\d&#123;3&#125;)+(?!\d))/g</span>,<span class="string">','</span>)</span><br></pre></td></tr></table></figure></div></li><li><p>js法</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">formarMoney</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str.split(<span class="string">''</span>).reverse().reduce(<span class="function">(<span class="params">pre,next,index</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> （(index%<span class="number">3</span>) ? next : (next+<span class="string">','</span>)) + pre</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>toLocaleString 法(这个是真的牛皮)</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">23333333</span>).toLocaleString(<span class="string">'en-US'</span>)</span><br></pre></td></tr></table></figure></div></li></ol><h5 id="介绍一下ES模块语法"><a href="#介绍一下ES模块语法" class="headerlink" title="介绍一下ES模块语法"></a>介绍一下ES模块语法</h5><ul><li><p>使用<code>export</code>关键字导出一个变量或者类型</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> someVar = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> type someType = &#123;</span><br><span class="line">    foo:string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> interface someInterface = &#123;</span><br><span class="line">    foo ?:string</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 在提前定义好变量或者类型后，可以这样导出</span></span><br><span class="line"><span class="keyword">export</span> &#123;someVar,someType&#125;</span><br><span class="line"><span class="comment">// 重命名变量导出</span></span><br><span class="line"><span class="keyword">export</span> &#123;someVar <span class="keyword">as</span> aDifferentName&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>使用<code>import</code>关键字导入一个变量或者一个类型</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;someVar,someType&#125; <span class="keyword">from</span> <span class="string">'./foo'</span></span><br><span class="line"><span class="comment">// 重命名导入变量或者类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; someVar <span class="keyword">as</span> aDifferentName &#125; <span class="keyword">from</span> <span class="string">'./foo'</span>;</span><br><span class="line"><span class="comment">// 使用整体加载</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> foo <span class="keyword">from</span> <span class="string">'./foo'</span>; <span class="comment">// 你可以这样使用foo.someVar了</span></span><br><span class="line"><span class="comment">// 仅导入模块</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'core-js'</span>; <span class="comment">//工具库</span></span><br><span class="line"><span class="comment">// 从其他模块导入后整体导出：</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">'./foo'</span>;</span><br><span class="line"><span class="comment">// 从其他模块导入后，部分导出</span></span><br><span class="line"><span class="keyword">export</span> &#123; someVar &#125; <span class="keyword">from</span> <span class="string">'./foo'</span>;</span><br></pre></td></tr></table></figure></div></li><li><p>使用默认导入/导出 <code>export default</code></p><blockquote><p>使用<code>export defalut</code>与<code>export</code>的区别:</p><ol><li>导入使用时可以根据需要自定义导入命名,比如这样的语法<code>import someName from &#39;someModule&#39;</code></li><li>导出变量，函数，类不需要提前定义，比如<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (someVar = <span class="number">123</span>);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">someFunction</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">someClass</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></div></li></ol></blockquote></li><li><p>重写类型的动态查找</p><blockquote><p>在项目里可以通过<code>declare module &#39;somePath&#39;</code>来声明一个全局模块的方式，用来解决查找模块路径的问题<br>全局类型声明写法</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局类型声明写法</span></span><br><span class="line"><span class="comment">// **暴露**</span></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'foo'</span> &#123;</span><br><span class="line"><span class="comment">// some variable declarations</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> bar: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// **引入**</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> foo <span class="keyword">from</span> <span class="string">'foo'</span>;</span><br></pre></td></tr></table></figure></div></blockquote><blockquote><p>模块导出声明写法</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块导出声明写法</span></span><br><span class="line">declare interface funcAbcSign &#123;</span><br><span class="line">    (s: string): string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> declare <span class="keyword">let</span> abc: funcAbcSign;</span><br><span class="line"><span class="keyword">export</span> declare <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 引入</span></span><br><span class="line"><span class="function"><span class="title">import</span> </span>&#123;funcAbcSign,abc&#125; <span class="keyword">from</span> <span class="string">'foo'</span>;</span><br></pre></td></tr></table></figure></div></blockquote><blockquote><p>全局类型声明里的名称将被引入整个 TypeScript 全局命名空间中，从引用这个 声明文件起就可以自由使用。<br>模块导出声明里的名称必须通过 import/require 才能使用。</p></blockquote></li></ul><h4 id="提升篇-1"><a href="#提升篇-1" class="headerlink" title="提升篇"></a>提升篇</h4><h5 id="介绍一下你了解的排序方式"><a href="#介绍一下你了解的排序方式" class="headerlink" title="介绍一下你了解的排序方式"></a>介绍一下你了解的排序方式</h5><h6 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h6><blockquote><p>冒泡排序是一种非常简单的排序方式，这个算法的名字由来是因为越小的元素会经由交换慢慢“浮”到数列的顶端。<br>排序基本思想为循环序列内每一个元素，循环到的元素与相邻的元素作对比，每次循环会将最小或者最大值冒泡至最底部，直到整个循环结束。</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>,l=arr.length;i&lt;l;i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;l<span class="number">-1</span>-i;j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">let</span> tmp = arr[j+<span class="number">1</span>];</span><br><span class="line">            arr[j+<span class="number">1</span>] = arr[j];</span><br><span class="line">            arr[j] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><blockquote><p>改进冒泡排序: 设置一标志性变量pos,用于记录每趟排序中最后一次进行交换的位置。由于pos位置之后的记录均已交换到位,故在进行下一趟排序时只要扫描到pos位置即可。<br>改进后如下</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i = arr.length<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">while</span>(i &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;i;j++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[j]&gt;arr[j+<span class="number">1</span>])&#123;</span><br><span class="line">            pos = j;</span><br><span class="line">            <span class="keyword">var</span> tmp = arr[j];</span><br><span class="line">            arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">            arr[j+<span class="number">1</span>] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    i = pos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><h6 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h6><blockquote><p>选择排序是一种简单直观的排序算法，它的原理是:首先在未排序序列中找到最小（大）元素，存放到排序序列的起始位置，然后，再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> tmp,minIndex;</span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>,l=arr.length;i&lt;l<span class="number">-1</span>;i++)&#123;</span><br><span class="line">     minIndex = i;</span><br><span class="line">     <span class="keyword">for</span>(<span class="keyword">let</span> j=i+<span class="number">1</span>;j&lt;l;j++)&#123;</span><br><span class="line">         <span class="keyword">if</span>(arr[j]&lt;arr[minIndex])&#123;</span><br><span class="line">             minIndex = j;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     tmp = arr[i];</span><br><span class="line">     arr[i] = arr[minIndex];</span><br><span class="line">     arr[minIndex] = tmp;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></div><h6 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h6><blockquote><p>插入排序的远离应该是最容易理解的了，就像打扑克牌，摸到牌以后，你需要对牌进行从小到大的排序，如果你打扑克从不排序，那当我没说…<br>它的工作原理是，构造一个有序序列，然后拿未排序的数据在已排序序列中从后向前扫描，找到相应位置插入。</p></blockquote><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JS"><figure class="iseeu highlight /js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">1</span>,l=arr.length;i&lt;l;i++)&#123;</span><br><span class="line">    <span class="keyword">let</span> key = arr[i];</span><br><span class="line">    <span class="keyword">var</span> j = i<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(j&gt;=<span class="number">0</span> &amp;&amp; arr[j]&gt;key)&#123;</span><br><span class="line">        arr[j+<span class="number">1</span>] = arr[j];</span><br><span class="line">        j--;</span><br><span class="line">    &#125;</span><br><span class="line">    arr[j+<span class="number">1</span>]=key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>未完待续…</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; 这两天面试了一些前端同行，面试别人同样是宝贵的经验，因为在问别人的同时，自己也会思考，这题的答案是什么，除了这种解法还有没有其他解法呢？所以这篇博文，我把自己问的问题作一个归纳与总结，并分为三个层次，&lt;strong&gt;基础&lt;/strong&gt;，&lt;strong&gt;提升&lt;/strong&gt;，&lt;strong&gt;高级&lt;/strong&gt;，并且写一些比较冷门的前端知识。&lt;/p&gt;
    
    </summary>
    
      <category term="面试" scheme="http://blog.zijunfe.cn/categories/%E9%9D%A2%E8%AF%95/"/>
    
    
  </entry>
  
  <entry>
    <title>如何给自己的博客添加评论系统</title>
    <link href="http://blog.zijunfe.cn/2019/04/11/blog-comments/"/>
    <id>http://blog.zijunfe.cn/2019/04/11/blog-comments/</id>
    <published>2019-04-11T07:48:32.310Z</published>
    <updated>2019-04-29T06:00:53.098Z</updated>
    
    <content type="html"><![CDATA[<p>想要做一个骚气的博主，没有一个评论系统怎么行呢</p><p><div style="width:170px;margin:0 auto;"><img src="/2019/04/11/blog-comments/sao.gif" alt="你好骚啊"></div><br>打开我的Google复制一下别人的，<br>呸，<br>打开我的Google搜索一下前辈们的经验。<br><a id="more"></a><br>首先，我了解到的是next官网推荐的几种评论插件，分别是以下这几个哥们<br><code>DISQUS</code> <code>Facebook Comments</code> <code>HyperComments</code> <code>网易云跟帖</code> <code>来必力</code></p><p><div style="width:170px;margin:0 auto;"><img src="/2019/04/11/blog-comments/emm.jpg" alt="emm"></div><br>从名字上来说，我选择最后一个试一下(绝对不是我看不懂别人官网，绝对不是!)</p><h4 id="来必力"><a href="#来必力" class="headerlink" title="来必力"></a>来必力</h4><p>来必力(这特喵的居然是个韩文网站) 这款评论系统比较简单，首先要去人家官网注册一个账号，登陆以后根据提示申请一个免费的city版什么鬼的，然后在代码里能得到一串LiveRe UID，在next 的<code>_config.yml</code>文件里编辑<code>livere_uid</code>字段，就完成啦，系不系很简单？效果如下<br><img src="/2019/04/11/blog-comments/laibili.jpg" alt="来必力"><br>然后我觉得太丑了，不符合next的黑白简约主题，而且很大概率进入页面后需要重新刷新才能显示出来，所以我就放弃了。</p><p><div style="width:170px;margin:0 auto;"><img src="/2019/04/11/blog-comments/xianqi.jpg" alt="嫌弃"></div></p><h4 id="Gitment"><a href="#Gitment" class="headerlink" title="Gitment"></a>Gitment</h4><p>接下来我又在茫茫Google中搜索，然后找到了它，看介绍说是通过github提issue的方式来创建一个评论系统，看到github我嘴角疯狂上扬，符合我的气质，这个我看行，开搞！</p><ul><li><p>首先在<a href="https://github.com/settings/developers" target="_blank" rel="noopener">https://github.com/settings/developers</a>申请一个免费的application，根据提示填写如下内容，</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Application name：blog-comments  // 随便写啥，你能记住就好 </span><br><span class="line">Homepage URL：https://网站地址/  // 你的博客地址</span><br><span class="line">Application description：Blog comment system  // 随便写</span><br><span class="line">Authorization callback URL：https://网站地址/  // 你的博客地址</span><br></pre></td></tr></table></figure></div><p> 创建完成后先不要关闭，<code>client_id</code>与<code>client_secret</code>下面要用</p></li><li>接着在你的github新建一个空的仓库来存放评论，比如叫做<code>blog-comments</code></li><li>然后在主题配置文件<code>_config.yml</code>里填写gitment的相关配置<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gitment:</span><br><span class="line">  enable: true  // 这个改成true</span><br><span class="line">  mint: true # RECOMMEND, A mint on Gitment, to support count, language and proxy_gateway</span><br><span class="line">  count: true # Show comments count in post meta area</span><br><span class="line">  lazy: false # Comments lazy loading with a button</span><br><span class="line">  cleanly: false # Hide &apos;Powered by ...&apos; on footer, and more</span><br><span class="line">  language: zh-Hans # Force language, or auto switch by theme</span><br><span class="line">  github_user: BiYangJun # MUST HAVE, Your Github ID</span><br><span class="line">  github_repo: blog-comments # MUST HAVE, The repo you use to store Gitment comments 这是你新建的存放评论的库</span><br><span class="line">  client_id: # MUST HAVE, Github client id for the Gitment 刚刚创建application里有的</span><br><span class="line">  client_secret: # EITHER this or proxy_gateway, Github access secret token for the Gitment 刚刚创建application里有的</span><br><span class="line">  proxy_gateway: # Address of api proxy, See: https://github.com/aimingoo/intersect</span><br><span class="line">  redirect_protocol: # Protocol of redirect_uri with force_redirect_protocol when mint enabled</span><br></pre></td></tr></table></figure></div></li></ul><p>全部配置完后，一切看起来很顺利，页面底部也出来了评论框，就差最后一步登陆自己的github来初始化了，一开始本地登陆不了，我以为是要部署后才能登陆，然后我部署了上去，心里想着这下成了!</p><p><div style="width:170px;margin:0 auto;"><img src="/2019/04/11/blog-comments/shangyang.jpg" alt="嘴角上扬"></div><br>部署后，我点击登陆后，一直给我报错<code>[object ProgressEvent]</code>，试了很多次，我还一度怀疑是不是我github密码输错了，纳闷的我去看了一下gitment的issue，最后发现原因大概是gitment的网站证书到期了，gitment需要这个为接口，所以一直报错。<br>辛辛苦苦1小时，我…</p><p><div style="width:170px;margin:0 auto;" center><img src="/2019/04/11/blog-comments/wufuckshuo.jpg" alt="无话可说"></div><br>哎，接着在茫茫Google找吧…</p><h4 id="Gitalk"><a href="#Gitalk" class="headerlink" title="Gitalk"></a>Gitalk</h4><p>接着，在茫茫博客中，我发现了<a href="https://www.lizhechen.com/" target="_blank" rel="noopener">戳兔专家</a>这位大哥的博文，跟着他的教程开始了安装<code>Gitalk</code>,帖个<a href="https://github.com/gitalk/gitalk" target="_blank" rel="noopener">官网</a>。</p><h5 id="首先"><a href="#首先" class="headerlink" title="首先"></a>首先</h5><p>刚刚申请的application和新建存放评论的仓库不要丢，裹上鸡蛋液，放在油锅里炸一炸，隔壁小孩…<br>住嘴！<br>由于next还没有集成gitalk，所以配置起来相当繁琐</p><ul><li>首先还是要在github上申请一个application和新建一个存放评论的仓库(上面的就可以用)</li><li><p>在 /layout/_third-party/comments/ 目录下新建 gitalk.swig 文件，内容如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if page.comments &amp;&amp; theme.gitalk.enable %&#125;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/gitalk/dist/gitalk.css&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;https://unpkg.com/gitalk/dist/gitalk.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        var gitalk = new Gitalk(&#123;</span><br><span class="line">          clientID: &apos;&#123;&#123; theme.gitalk.ClientID &#125;&#125;&apos;,</span><br><span class="line">          clientSecret: &apos;&#123;&#123; theme.gitalk.ClientSecret &#125;&#125;&apos;,</span><br><span class="line">          repo: &apos;&#123;&#123; theme.gitalk.repo &#125;&#125;&apos;,</span><br><span class="line">          owner: &apos;&#123;&#123; theme.gitalk.owner &#125;&#125;&apos;,</span><br><span class="line">          admin: [&apos;&#123;&#123; theme.gitalk.adminUser &#125;&#125;&apos;],</span><br><span class="line">          id: location.pathname,</span><br><span class="line">          distractionFreeMode: &apos;&#123;&#123; theme.gitalk.distractionFreeMode &#125;&#125;&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">        gitalk.render(&apos;gitalk-container&apos;)           </span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>修改 /layout/_partials/comments.swig，在最后一个 elseif 后添加字段，修改后如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> &#123;% elseif theme.gitment.enable %&#125;</span><br><span class="line">    &lt;div class=&quot;comments&quot; id=&quot;comments&quot;&gt;</span><br><span class="line">      &#123;% if theme.gitment.lazy %&#125;</span><br><span class="line">        &lt;div onclick=&quot;showGitment()&quot; id=&quot;gitment-display-button&quot;&gt;&#123;&#123; __(&apos;gitmentbutton&apos;) &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div id=&quot;gitment-container&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &#123;% else %&#125;</span><br><span class="line">        &lt;div id=&quot;gitment-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">      &#123;% endif %&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &#123;% elseif theme.valine.appid and theme.valine.appkey %&#125;</span><br><span class="line">    &lt;div class=&quot;comments&quot; id=&quot;comments&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  </span><br><span class="line">  &#123;% elseif theme.gitalk.enable %&#125;</span><br><span class="line">    &lt;div id=&quot;gitalk-container&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>修改 /layout/_third-party/comments/index.swig，在其末尾添加如下字段：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &apos;gitalk.swig&apos; %&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>设置 gitalk 的样式，参考1： 在 /source/css/_common/components/third-party/ 目录下新建 gitalk.styl 文件，内容如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.gt-header a, .gt-comments a, .gt-popup a</span><br><span class="line">  border-bottom: none;</span><br><span class="line">.gt-container .gt-popup .gt-action.is--active:before</span><br><span class="line">  top: 0.7em;</span><br></pre></td></tr></table></figure></div></li><li><p>修改 /source/css/_common/components/third-party/third-party.styl 文件，在末尾添加如下字段：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@import &quot;gitalk&quot;;</span><br></pre></td></tr></table></figure></div></li><li><p>最后在主题配置文件 _config.yml 中添加如下项：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gitalk:</span><br><span class="line">  enable: true</span><br><span class="line">  owner: 你的github帐号  # lzcwr  </span><br><span class="line">  repo: 存放评论的仓库名称   # Gitalk-comments</span><br><span class="line">  ClientID: 在申请好application的页面中有</span><br><span class="line">  ClientSecret: 在申请好application的页面中有</span><br><span class="line">  adminUser: 你的github帐号 # 可初始化评论的账户</span><br><span class="line">  distractionFreeMode: true</span><br></pre></td></tr></table></figure></div></li></ul><p>完整无误地完成上述步骤后，在本地可以看到gitalk的按钮，然后通过<code>hexo d</code>部署到线上后，登陆你的github进行初始化就大功告成了啦！</p><blockquote><p>如果你给一篇博文的文件命名有中文的话，你可能会碰到这个报错Error: Validation Failed。哎，真是一波三折啊</p></blockquote><h5 id="Error-Validation-Failed-解决方案"><a href="#Error-Validation-Failed-解决方案" class="headerlink" title="Error: Validation Failed 解决方案"></a>Error: Validation Failed 解决方案</h5><ol><li><p>修改前文提到的<code>gitalk.swig</code>，先下载一个<a href="https://github.com/blueimp/JavaScript-MD5/blob/master/js/md5.min.js" target="_blank" rel="noopener">md5.js</a>,更改完毕后的<code>gitalk.swig</code>如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if page.comments &amp;&amp; theme.gitalk.enable %&#125;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/gitalk/dist/gitalk.css&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;/js/md5.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;https://unpkg.com/gitalk/dist/gitalk.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">        var gitalk = new Gitalk(&#123;</span><br><span class="line">          clientID: &apos;&#123;&#123; theme.gitalk.ClientID &#125;&#125;&apos;,</span><br><span class="line">          clientSecret: &apos;&#123;&#123; theme.gitalk.ClientSecret &#125;&#125;&apos;,</span><br><span class="line">          repo: &apos;&#123;&#123; theme.gitalk.repo &#125;&#125;&apos;,</span><br><span class="line">          owner: &apos;&#123;&#123; theme.gitalk.owner &#125;&#125;&apos;,</span><br><span class="line">          admin: [&apos;&#123;&#123; theme.gitalk.adminUser &#125;&#125;&apos;],</span><br><span class="line">          id: md5(location.pathname),</span><br><span class="line">          distractionFreeMode: &apos;&#123;&#123; theme.gitalk.distractionFreeMode &#125;&#125;&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">        gitalk.render(&apos;gitalk-container&apos;)           </span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></div></li><li><p>批量修改博客文件名，例如以时间戳的方式命名md文件，具体可以参考这位<a href="https://blog.lanthora.org/20181229230044/" target="_blank" rel="noopener">大哥的博文</a></p></li><li>避免使用中文命名，英文不好咱们就用拼音吧！</li></ol><p>忙活了一晚上我的评论系统终于搞定了…</p><p><div style="width:170px;margin:0 auto;"><img src="/2019/04/11/blog-comments/geyou.gif" alt="葛优"></div><br>感谢万能的Google和<a href="https://www.lizhechen.com/" target="_blank" rel="noopener">戳兔专家</a>这位大哥。<br>看完的小伙伴记得评论、关注、收藏三连哦～<br>呸、<br>什么坏毛病<br>能给评论就感激不尽啦～</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;想要做一个骚气的博主，没有一个评论系统怎么行呢&lt;/p&gt;
&lt;p&gt;&lt;div style=&quot;width:170px;margin:0 auto;&quot;&gt;&lt;img src=&quot;/2019/04/11/blog-comments/sao.gif&quot; alt=&quot;你好骚啊&quot;&gt;&lt;/div&gt;&lt;br&gt;打开我的Google复制一下别人的，&lt;br&gt;呸，&lt;br&gt;打开我的Google搜索一下前辈们的经验。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="博客" scheme="http://blog.zijunfe.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
  </entry>
  
  <entry>
    <title>记录一下搭建第一个博客的经历</title>
    <link href="http://blog.zijunfe.cn/2019/04/10/first-blog/"/>
    <id>http://blog.zijunfe.cn/2019/04/10/first-blog/</id>
    <published>2019-04-10T03:42:33.791Z</published>
    <updated>2019-04-29T06:00:53.085Z</updated>
    
    <content type="html"><![CDATA[<p>  起因，在论坛闲逛的时候发现一个老哥把很多知识点，问题都记录在自己的个人博客里，知识罗列的很清楚。<br>虽然我平时也会把一些问题和有趣的东西记录在MacDown里，可时如果要看的话还需要打开mac，很不方便。so～在网上找了一篇搭建博客的教程，干了一晚上终于成了，中间碰到很多曲折的问题，所以在这里记录一下。</p><p><strong>一、搭建条件及环境</strong><br>    Github Pages + Hexo + Node.js Mac电脑的OSX系统/windows<br><strong>二、搭建步骤</strong><br><a id="more"></a></p><ol><li><p>首先你得有个github账号(作为新时代的码农，这是必备的)，创建一个新的repository，项目名称格式为<code>yourname.github.io</code>，如图<br> <img src="/2019/04/10/first-blog/img1.jpg" alt></p></li><li><p>全局安装Hexo，<code>npm install -g hexo-cli</code></p></li><li><p>创建一个空文件夹，进入该文件夹，依次执行以下命令</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br><span class="line">npm install</span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></div><p> 在所有依赖都安装完成后，就可以在本地环境看一下hexo的博客内容啦，执行以下命令</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate  </span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure></div><p> 这两条命令可以缩写成<code>hexo g</code> <code>hexo s</code>作用分别是：将md文件生成html，css文件；启动本地hexo。打开<a href="http://localhost:4000就能看到本地效果啦。" target="_blank" rel="noopener">http://localhost:4000就能看到本地效果啦。</a></p></li><li><p>修改 _config.yml 文件，这是博客网站 的配置文件，在这里你可以更改你的网页title，description等，最主要的是修改你在github上的仓库地址。<br> 在最下面一行</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">    type: git</span><br><span class="line">    repository: git@github.com:BiYangJun/zijun.github.io.git</span><br><span class="line">    branch: master</span><br></pre></td></tr></table></figure></div><p> 写上自己的仓库地址。至于是SSH公钥方式提交还是https方式提交，看个人喜好啦。</p></li><li><p>在写完自己的博客后，执行以下命令</p> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></div><p> <code>hexo deploy</code> 可以缩写成 <code>hexo d</code>意思为部署<br> 接着你会上传文件到github上。接着就可以在线访问啦。</p></li><li><p>那么如何在线访问呢？<br> 打开你的github。点击<code>environment</code>，<br> <img src="/2019/04/10/first-blog/img5.jpg" alt><br> 然后在点击 <code>View deployment</code>,打开后的网址就是你的线上博客地址辣，easy～</p></li></ol><p><strong>三、遇到的坑</strong></p><ol><li><p>如果发现线上博客一直是404，看一下repository中的setting，在GitHub Pages 这一栏中Source有没有选中master分支</p><p> <img src="/2019/04/10/first-blog/img2.jpg" alt></p></li><li><p>能打开线上博客后，如果发现样式没有加载出来，在_config.yml修改root为自己的项目名称</p><p> <img src="/2019/04/10/first-blog/img3.jpg" alt></p></li><li><p>其他hexo命令。<code>hexo clean</code>#缓存，在网页不正常的时候可以使用。<code>hexo new ‘我的博客’</code>#新建我的博客，<code>hexo server -p 5000</code>#更改端口</p></li><li><p>如何插入图片。</p><ul><li>在主题的source下面新建一个文件夹images专门放置图片资源，使用markdown的语法 <code>![](/images/test.jpg)</code></li><li>Hexo方式，设置_config.yml文件中<code>post_asset_folder</code>为true，之后新建一个文章后，会同时创建一个同名的空文件夹用来放图片资源，执行命令<code>npm install hexo-asset-image --save</code>，下载安装一个可以上传本地图片的插件，之后使用的时候，只需要图片名<code>![](test.jpg)</code></li><li>网络图片插入‘#’</li><li><p>Hexo 支持使用特定的语法，插入指定大小的图片，如下：</p><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 语法</span><br><span class="line">&#123;% img [class names] /path/to/image [width] [height] [title text [alt text]] %&#125;</span><br><span class="line">// 实例</span><br><span class="line">&#123;% img full-image /hexo-experiences/PL01.jpg 180 180 hello %&#125;</span><br><span class="line">// 生成的代码</span><br><span class="line">&lt;img src=&quot;/blog/hexo-experiences/PL01.jpg&quot; class=&quot;full-image&quot; width=&quot;180&quot; height=&quot;180&quot; title=&quot;hello&quot;&gt;</span><br></pre></td></tr></table></figure></div></li><li><p>如果发现怎么都不行，看下你这个博客是不是在二级域名下的，如果是，要设置_config.yml文件中的url与root。<br><img src="/2019/04/10/first-blog/img4.jpg" alt></p></li></ul></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;  起因，在论坛闲逛的时候发现一个老哥把很多知识点，问题都记录在自己的个人博客里，知识罗列的很清楚。&lt;br&gt;虽然我平时也会把一些问题和有趣的东西记录在MacDown里，可时如果要看的话还需要打开mac，很不方便。so～在网上找了一篇搭建博客的教程，干了一晚上终于成了，中间碰到很多曲折的问题，所以在这里记录一下。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;一、搭建条件及环境&lt;/strong&gt;&lt;br&gt;    Github Pages + Hexo + Node.js Mac电脑的OSX系统/windows&lt;br&gt;&lt;strong&gt;二、搭建步骤&lt;/strong&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="博客" scheme="http://blog.zijunfe.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
  </entry>
  
</feed>
